"デリヘルで自宅派遣を希望するお客さんって何割くらいですか？【はじめての風俗アルバイト】'; $('body').append(init_style); } //リスト作成 this.set(); //リスト作成が完全に終わるよう遅らせる（サファリでバグ発生するため） setTimeout(function(){ //スタイル等作成 Slider.style(); //自動スライドスタート Slider.repeat(); //手動スライドアクションセット $(\".slider_dot_img, #slide_left, #slide_right\").click(function(){ num = $(this).attr(\"data-num\"); Slider.count(num); }); //フリックアクション $(\"#slider_move_area li\").on({ /* フリック開始時 */ 'touchstart': function(e) { this.touchX = event.changedTouches[0].pageX; this.touchY = event.changedTouches[0].pageY; }, /* フリック中 */ 'touchmove': function(e) { this.slideX = this.touchX - event.changedTouches[0].pageX; this.slideY = this.touchY - event.changedTouches[0].pageY; if(Math.abs(this.slideX) > Math.abs(this.slideY)){ e.preventDefault(); } }, /* フリック終了 */ 'touchend': function(e) { if (this.slideX > 30) {//←へフリック Slider.count('next'); }else if(this.slideX < -30){//→へフリック Slider.count('prev'); } this.slideX = 0; } }); }, 500); } } //値取得とliの数からスタイル指定 ,set: function() { max = $('#slider_move_area li').length; prev_slide = max; //各li要素のクローンを作成 var clone = $(\"#slider_move_area li\").clone(true); //クローンをliの最後に追加 clone.clone(true).insertAfter($(\"#slider_move_area li:last\")); //クローンをliの最初に追加 clone.clone(true).insertBefore($(\"#slider_move_area li:first\")); } ,style: function() { //各種計算 var li_cnt = $('#slider_move_area li').length; var nth = max + 1; var width = li_cnt * 80;//% var max_width = li_cnt * Slider.img_w;//px var sp_width = li_cnt * 100;//% li_width = 100 / li_cnt;//% if(max == 2){ var movement = 0.5; }else if(max % 2 == 0){ var movement = 1.5; }else{ var movement = 1; } var pc_mgin = (max_width / 2 * -1) + (Slider.img_w * movement);//px var tb_mgin = (width / 2 * -1) + 80 * movement;//% var sp_mgin = (sp_width / 2 * -1) + 100 * movement;//% //スタイル生成 var style = ''; $('body').append(style); } //スライドさせる数の指定 ,count: function(num) { //現在の位置を取得 if(next_slide == 1){ now = max; }else{ now = next_slide - 1; } //次のスライド位置を取得 if(num == 'next'){ num = next_slide; if(num == 1){ change = 1; }else{ change = num - now; } }else if(num == 'prev'){ num = prev_slide; if(num == max){ change = -1; }else{ change = num - now; } }else{ change = num - now; } //changeが0なら終了 if(change == '0'){ return; } //changeの値に応じて左右スライド方向振り分け if(change > 0){ Slider.right_exe(change,num); }else{ Slider.left_exe(change,num); } } //一定時間毎にスライドさせる処理 ,repeat: function() { setInterval(function(max) { if(slideflag && slider_stop){ slideflag = false; fin_animation = true; $(\"#slider_move_area li\").animate({ left : '-' + li_width +'%' }, { duration : 500, complete : function() { $(\"#slider > li\").css('left','0px'); if(fin_animation){ fin_animation = false; //処理完了時に先頭要素を削除 $(\"#slider > li:first-child\").insertAfter($(\"#slider_move_area li:last\")); Slider.slider_on(next_slide); slideflag = true; } } }); } }, Slider.pause); } //右側へスライドさせる処理 ,right_exe: function(change, num) { if(change == 0){ return; }else if(change < 0){ change = change * -1; } if(slideflag){ slideflag = false; slider_stop = false; fin_animation = true; var moving = li_width * change; $(\"#slider_move_area li\").animate({ left : '-' + moving +'%' }, { duration : 500, complete : function() { $(\"#slider > li\").removeAttr('style'); if(fin_animation){ fin_animation = false; for (var i = 1; i <= change; i++){ //処理完了時に先頭要素を削除 $(\"#slider > li:first-child\").insertAfter($(\"#slider_move_area li:last\")); } Slider.slider_on(num); slideflag = true; setTimeout(function(){ slider_stop = true; }, 7000); } } }); } } //左側へスライドさせる処理 ,left_exe: function(change, num) { if(change == 0){ return; }else if(change < 0){ change = change * -1; } if(slideflag){ slideflag = false; slider_stop = false; fin_animation = true; var moving = li_width * change; $(\"#slider_move_area li\").animate({ left : moving + '%' }, { duration : 500, complete : function(){ if(fin_animation){ fin_animation = false; for (var i = 1; i <= change; i++){ //liの最初に追加 $(\"#slider > li:last-child\").insertBefore($(\"#slider_move_area li:first\")); } Slider.slider_on(num); slideflag = true; setTimeout(function(){ slider_stop = true; }, 7000); } $(\"#slider > li\").removeAttr('style'); } }); } } //スライド下にある画像のオンオフ切り替え ,slider_on: function(get_id) { $(\".slider_dot_img img\").attr(\"src\",\"/img/common/image_select_off.png\"); $(\"#slide_\" + get_id + \" img\").attr(\"src\",\"/img/common/image_select_on.png\"); if(get_id >= max){ next_slide = 1; prev_slide = parseInt(get_id) - 1; }else if(get_id == 1){ prev_slide = max; next_slide = parseInt(get_id) + 1; }else{ next_slide = parseInt(get_id) + 1; prev_slide = parseInt(get_id) - 1; } } } /*------------------------------------------------ ゾーン一覧マウスオン処理 ------------------------------------------------*/ Zone_list = { init: function() { if($('.area_search_box').size()){ $('.area_search_box').hover( function(){ Zone_list.on_exe($(this)); }, function(){ Zone_list.off_exe($(this)); } ); } } ,on_exe: function(that) { if(that.hasClass('no_link'))return; that.find('.area_txt p').addClass('on_color'); } ,off_exe: function(that) { that.find('.on_color').removeClass('on_color'); } } /*------------------------------------------------ 人気～～のリンクマウスオン変化処理 ------------------------------------------------*/ Pop_link = { init: function() { if($('.pop_tbl').size()){ $('.pop_tbl').hover( function(){ Pop_link.over($(this)); }, function(){ Pop_link.out($(this)); } ); } } ,over: function(that) { that.find('.pop_rocket_head').css('background','url(/img/common/area_popularity_bg_01.png)'); that.find('.pop_rocket_middle').css('background','url(/img/common/area_popularity_bg_02.png)'); that.find('.pop_rocket_hip').css('background','url(/img/common/area_popularity_bg_03.png)'); } ,out: function(that) { that.find('.pop_rocket_head').css('background','url(/img/common/area_popularity_bg_01_off.png)'); that.find('.pop_rocket_middle').css('background','url(/img/common/area_popularity_bg_02_off.png)'); that.find('.pop_rocket_hip').css('background','url(/img/common/area_popularity_bg_03_off.png)'); } } /*------------------------------------------------ 急募の開閉処理(もっと見る) ------------------------------------------------*/ Kyubomore = { init: function() { this.res_flg = false; if($('#more_kyubo').size()){ $('#more_kyubo').click(function(){ Kyubomore.open(); }); $('#close_kyubo').click(function(){ Kyubomore.close(); }); } } ,open: function() { $('#kyubo_lists .kyubo_list_box:nth-child(1n+6)').slideDown(200); $('#more_kyubo').addClass('hide'); $('#close_kyubo').removeClass('hide'); this.res_flg = true; } ,close: function() { $.when( $('#close_kyubo').addClass('hide'), $('#more_kyubo').removeClass('hide'), $('#kyubo_lists .kyubo_list_box:nth-child(1n+6)').slideUp(200) ).done(function(){ $('body, html').animate({ scrollTop: $('#kyubo_title').offset().top}, 200) }); Kyubomore.res_flg = true; } ,reset: function() { if(this.res_flg){ $('#kyubo_lists .kyubo_list_box:nth-child(1n+6)').removeAttr('style'); $('#close_kyubo').addClass('hide'); $('#more_kyubo').removeClass('hide'); this.res_flg = false; } } } /*------------------------------------------------ スタッフブログの開閉処理(もっと見る) ------------------------------------------------*/ Blogmore = { init: function() { this.res_flg = false; if($('#more_blog').size()){ $('#more_blog').click(function(){ Blogmore.open(); }); $('#close_blog').click(function(){ Blogmore.close(); }); } } ,open: function() { $('#staff_blog_list_box section:nth-child(1n+6)').slideDown(200); $('#more_blog').addClass('hide'); $('#close_blog').removeClass('hide'); this.res_flg = true; } ,close: function() { var target_offset = $('#staff_blog_title').offset().top; var header_h = parseInt(Go_to.sp_header.outerHeight()); $.when( $('#staff_blog_list_box section:nth-child(1n+6)').slideUp(200), $('#close_blog').addClass('hide'), $('#more_blog').removeClass('hide') ).done(function(){ $('body, html').animate({ scrollTop: target_offset - header_h}, 200) }); } ,reset: function() { if(this.res_flg){ $('#staff_blog_list_box section:nth-child(1n+6)').removeAttr('style'); $('#close_blog').addClass('hide'); $('#more_blog').removeClass('hide'); this.res_flg = false; } } } /*------------------------------------------------ スクロールバーデザイン変更 ------------------------------------------------*/ Custom_scroll = { init: function() { if($('#staff_blog_list_box').size()){ var csObj = new Object(); csObj.scrollButtons = {enable:true}; $('#staff_blog_list_box').mCustomScrollbar(csObj); } } } /*------------------------------------------------ h1スマホサイズ時テキスト流し処理 ------------------------------------------------*/ Marquee = { init: function() { if($('#pagename').size()){ this.strflg = true; this.stpflg =true; this.start(); } } ,start: function() { if(win_w <= 1000 && this.strflg){ this.strflg = false; var txt_w = parseInt($('#pagename span').width()); $('#pagename').animate({ left: '-' + txt_w + 'px' },{ duration : 10000, easing: 'linear', complete : function(){ $('#pagename').css('left',win_w + 'px'); Marquee.strflg = true; Marquee.start(); } }); this.stpflg = true; }else if(win_w >= 1000 && this.stpflg){ this.stpflg = false; $('#pagename').stop(); $('#pagename').removeAttr('style'); this.strflg = true; } } } /*------------------------------------------------ ゾーンTOPテキスト開閉 ------------------------------------------------*/ Zone_opener = { init: function() { if($('#zone_txt_text').size()){ $('#open_allow').click(function(){ Zone_opener.open(); }); $('#close_allow').click(function(){ Zone_opener.close(); }); } if($('#sp_hide_wrap').size()){ $('#open_allow_area').click(function(){ Zone_opener.area_open(); }); $('#close_allow_area').click(function(){ Zone_opener.area_close(); }); } } ,open: function() { $('#zone_txt_text').slideDown(300); $('#open_allow').addClass('hide'); $('#close_allow').removeClass('hide'); } ,close: function() { $('#zone_txt_text').slideUp(300); $('#close_allow').addClass('hide'); $('#open_allow').removeClass('hide'); } ,area_open: function() { $('#sp_hide_wrap').slideDown(300); $('#open_allow_area').addClass('hide'); $('#close_allow_area').removeClass('hide'); } ,area_close: function() { $('#sp_hide_wrap').slideUp(300); $('#close_allow_area').addClass('hide'); $('#open_allow_area').removeClass('hide'); } ,reset: function() { $('#zone_txt_text').removeAttr('style'); $('#close_allow').addClass('hide'); $('#open_allow').removeClass('hide'); $('#sp_hide_wrap').removeAttr('style'); $('#close_allow_area').addClass('hide'); $('#open_allow_area').removeClass('hide'); } } /*------------------------------------------------ パンくず横幅調整 ------------------------------------------------*/ Bread_wide = { init: function() { if($('#breadlist_box').size()){ this.check(); } } ,check: function() { this.resizesize = 25; for (var i = 0; i < $('#breadlist_lists li').length; i++){ this.resizesize += parseInt($('#breadlist_lists li').eq(i).outerWidth()); } this.resize(); } ,resize: function() { $('#breadlist_lists').css('width',this.resizesize + 'px'); $('.bread_scrooll').scrollLeft(this.resizesize); } } /*------------------------------------------------ スクロールボックス型スライダー（vipbanner、supervipbanner、店舗詳細detail、等） ------------------------------------------------*/ Scrollslider = { init: function() { if($('.slide_left_btn').size()){ this.flg = true; $('.scroll_slider').scrollLeft(0); //左ボタンクリック $('.slide_left_btn').click(function(){ Scrollslider.target = $(this).data('slider'); Scrollslider.left($(this).data('no')); }); //右ボタンクリック $('.slide_right_btn').click(function(){ Scrollslider.target = $(this).data('slider'); Scrollslider.right($(this).data('no')); }); //矢印半透明 $('.scroll_slider').scroll(function(){ //console.log(parseInt($(this).outerWidth())); if($(this).scrollLeft() <= 2){ //console.log(\"1\", '.' + Scrollslider.target_right, '.' + Scrollslider.target_left, $(this).data('no')); Scrollslider.target_right = $(this).data('right'); $('.' + Scrollslider.target_right + '.' + $(this).data('no')).css('opacity','1'); Scrollslider.target_left = $(this).attr('data-left'); $('.' + Scrollslider.target_left + '.' + $(this).data('no')).css('opacity','0.3').css('cursor','auto'); }else if(Math.abs($(this).scrollLeft()) + parseInt($(this).outerWidth()) >= parseInt($('#' + $(this).data('max')).width()) - 2){ //console.log(\"2\", '.' + Scrollslider.target_right, '.' + Scrollslider.target_left, $(this).data('no')); Scrollslider.target_left = $(this).attr('data-left'); $('.' + Scrollslider.target_left + '.' + $(this).data('no')).css('opacity','1'); Scrollslider.target_right = $(this).data('right'); $('.' + Scrollslider.target_right + '.' + $(this).data('no')).css('opacity','0.3').css('cursor','auto'); }else{ //console.log(\"3\", '.' + Scrollslider.target_right, '.' + Scrollslider.target_left, $(this).data('no')); Scrollslider.target_right = $(this).data('right'); Scrollslider.target_left = $(this).attr('data-left'); $('.' + Scrollslider.target_right + '.' + $(this).data('no') + ', .' + Scrollslider.target_left + '.' + $(this).data('no')).css('opacity','1').css('cursor','pointer'); } }); //無料店舗詳細スライダーのみの処理 if($('#other_req_move_area').size()){ //NOTE: 複数あった場合に、liの数だと計算が狂う //NOTE: そのため、全体に及ぼすが、自身のliタグの数を属性にいれておく var other_req_wid = $('#other_req_move_area li').length * parseInt($('#other_req_move_area li:first-child').outerWidth(true)); //特殊ケースは、個別に横幅を測りなおす if($('.other_req_move_area.n1').size()) { var other_req_wid = $('.other_req_move_area.n1').data('sum') * parseInt($('.other_req_move_area.n2 li:first-child').outerWidth(true)); console.log(\"sum :: \" + $('.other_req_move_area.n1').data('sum')); } if($('.other_req_move_area.n2').size()) { var other_req_wid = $('.other_req_move_area.n2').data('sum') * parseInt($('.other_req_move_area.n2 li:first-child').outerWidth(true)); console.log(\"sum :: \" + $('.other_req_move_area.n2').data('sum')); } if(other_req_wid < 638){ other_req_wid = 638; } //NOTE: 場合に寄り2か所あるので、ID指定はおかしくなる $('.other_req_move_area').css('width', (other_req_wid) + 'px'); } //地方スタンダードプラン店舗詳細スライダーのみの処理 if($('#other_req_move_area_standard').size()){ var other_req_wid = $('#other_req_move_area_standard li').length * parseInt($('#other_req_move_area_standard li:first-child').outerWidth(true)); if(other_req_wid < 638){ other_req_wid = 638; } $('.other_req_move_area_standard').css('width', (other_req_wid) + 'px'); } } } ,left: function(no) { //alert(no + \" :: \" + this.target); if(this.flg){ this.flg = false; var scrl_wid = (parseInt($('.' + this.target + '.' + no).scrollLeft()) - parseInt($('.' + this.target + '.' + no + ' li:first-child').outerWidth(true))); $('.' + this.target + '.' + no).animate({ scrollLeft : scrl_wid },200,function(){ Scrollslider.flg = true; }); } } ,right: function(no) {//target,move //alert(no + \" :: \" + this.target); if(this.flg){ this.flg = false; var scrl_wid = (parseInt($('.' + this.target + '.' + no).scrollLeft()) + parseInt($('.' + this.target + '.' + no + ' li:first-child').outerWidth(true))); //console.log(scrl_wid); $('.' + this.target + '.' + no).animate({ scrollLeft: scrl_wid },200,function(){ Scrollslider.flg = true; }); } } } /*------------------------------------------------ はじ風特典 スマホアコーディオン、POST送信 etc... ------------------------------------------------*/ Tokuten = { acod: { init: function() { this.res_flg = false; if($(\"#tokuten_sp_opne\").size()){ this.res_flg = true; $(\"#tokuten_sp_opne\").click(function(){ Tokuten.acod.open(); }); } } ,open: function() { $(\"#tokuten_sp_opne\").hide(); $(\"#tokuten_list\").slideDown(300); } ,reset: function() { if(this.res_flg){ $(\"#tokuten_sp_opne, #tokuten_list\").removeAttr('style'); } } } ,post: function(zone, block) { //alert(zone+', '+block); var form = document.createElement('form'); document.body.appendChild(form); var input = document.createElement('input'); input.setAttribute('name', 'block') input.setAttribute('value', block); form.appendChild(input); form.setAttribute('action', '/'+zone+'/privilege/'); form.setAttribute('method', 'POST'); form.submit(); } } /*------------------------------------------------ 複数行のテキスト末尾「...」付与 要素のclass名に「ellipsis」付ける。 属性「data-ellipsis」に文字の最大バイト数 「data-ellipsis」以上のバイト数があればテキスト省略し「...」付与 例：------------------------------------------------*/ Text_ellipsis = { init: function() { if($('.ellipsis').size){ this.txt_cnt = []; this.target_cnt = 0; this.prepare(); this.flg = false; } } ,prepare: function() { //ループ用に要素の数を取得 this.target_cnt = $('.ellipsis').length; var len = 0; var pc_lim = 0; var tb_lim = 0; var sp_lim = 0; var tgt = ''; this.target = []; for(var i='0'; i < this.target_cnt; i++){ tgt = $('.ellipsis').eq(i); this.target[i] = []; //属性data-pc-ellipsis取得 this.target[i]['max_pc'] = tgt.attr('data-pc-ellipsis'); //属性data-tb-ellipsis取得 this.target[i]['max_tb'] = tgt.attr('data-tb-ellipsis'); //属性data-sp-ellipsis取得 this.target[i]['max_sp'] = tgt.attr('data-sp-ellipsis'); //テキスト取得 this.target[i]['txt'] = tgt.text(); len = 0; pc_lim = 0; tb_lim = 0; sp_lim = 0; for(var s=0; s < this.target[i]['txt'].length; s++) { var c = this.target[i]['txt'].charCodeAt(s); if ((c >= 0x0 && c < 0x81) || (c == 0xf8f0) || (c >= 0xff61 && c < 0xffa0) || (c >= 0xf8f1 && c < 0xf8f4)){ len += 1; }else { len += 2; } if(this.target[i]['max_pc'] && this.target[i]['max_pc'] < len && pc_lim == 0){ pc_lim = s - 4; } if(this.target[i]['max_tb'] && this.target[i]['max_tb'] < len && tb_lim == 0){ tb_lim = s - 4; } if(this.target[i]['max_sp'] && this.target[i]['max_sp'] < len && sp_lim == 0){ sp_lim = s - 4; } } if(pc_lim != 0){ this.target[i]['pc_txt'] = this.target[i]['txt'].substr(0, pc_lim) + '...'; }else{ this.target[i]['pc_txt'] = false; } if(tb_lim != 0){ this.target[i]['tb_txt'] = this.target[i]['txt'].substr(0, tb_lim) + '...'; }else{ this.target[i]['tb_txt'] = false; } if(sp_lim != 0){ this.target[i]['sp_txt'] = this.target[i]['txt'].substr(0, sp_lim) + '...'; }else{ this.target[i]['sp_txt'] = false; } if(!this.target[i]['pc_txt'] && !this.target[i]['tb_txt'] && !this.target[i]['sp_txt']){ this.target[i]['allclear'] = true; }else{ this.target[i]['allclear'] = false; } } //console.log(this.txt_cnt); if(win_w >= 1000){ this.mode_pc(); }else if(win_w < 1000 && win_w >= 620){ this.mode_tb(); }else if(win_w < 620){ this.mode_sp(); } } ,mode_pc: function() { this.mode = 'pc_txt'; this.exe(); } ,mode_tb: function() { this.mode = 'tb_txt'; this.exe(); } ,mode_sp: function() { this.mode = 'sp_txt'; this.exe(); } ,exe: function() { for(var i='0'; i < this.target_cnt; i++){ if(!this.target[i]['allclear']){ if(this.target[i][this.mode]){ $('.ellipsis').eq(i).text(this.target[i][this.mode]); this.flg = true; }else if(this.flg){ $('.ellipsis').eq(i).text(this.target[i]['txt']); } } } } } /*------------------------------------------------ 新着求人の開閉処理(もっと見る) ------------------------------------------------*/ Newmore = { init: function() { this.res_flg = false; if($('#more_new').size()){ $('#more_new').click(function(){ Newmore.open(); }); $('#close_new').click(function(){ Newmore.close(); }); } } ,open: function() { $('#new_lists .new_list:nth-child(1n+6)').slideDown(200); $('#more_new').addClass('hide'); $('#close_new').removeClass('hide'); this.res_flg = true; } ,close: function() { var target_offset = $('#new_recruit_title').offset().top; var header_h = parseInt(Go_to.sp_header.outerHeight()); $.when( $('#new_lists .new_list:nth-child(1n+6)').slideUp(200), $('#close_new').addClass('hide'), $('#more_new').removeClass('hide') ).done(function(){ $('body, html').animate({ scrollTop: target_offset - header_h}, 200) }); } ,reset: function() { if(this.res_flg){ $('#new_lists .new_list:nth-child(1n+6)').removeAttr('style'); $('#close_new').addClass('hide'); $('#more_new').removeClass('hide'); this.res_flg = false; } } } /*------------------------------------------------ vipバナー、エリアバナースライダー処理 ------------------------------------------------*/ /*Bannerslide = { init: function() { if($('bannerslide_right_btn').size){ this.set(); this.flg = true; this.flg_onece = true; //左ボタンクリック $('.bannerslide_left_btn').click(function(){ Bannerslide.target = $(this).attr('data-slider'); Bannerslide.left(); }) //右ボタンクリック $('.bannerslide_right_btn').click(function(){ Bannerslide.target = $(this).attr('data-slider'); Bannerslide.right(); }) //スライダーフリック $(\".bannerslider_move\").on({ // フリック開始時 'touchstart': function(e) { Bannerslide.target = $(this).attr('id'); this.touchX = event.changedTouches[0].pageX; this.touchY = event.changedTouches[0].pageY; }, // フリック中 'touchmove': function(e) { this.slideX = this.touchX - event.changedTouches[0].pageX ; this.slideY = this.touchY - event.changedTouches[0].pageY ; this.moveRate = this.slideX / this.slideY; if(Math.abs(this.slideX) >= Math.abs(this.slideY)) { e.preventDefault(); } }, // フリック終了 'touchend': function(e) { if (this.slideX > 0) {//←へフリック Bannerslide.right(); }else if(this.slideX < 0){//→へフリック Bannerslide.left(); } this.slideX = 0; } }); } } ,set: function() { var ul_w = ''; var li_cnt = ''; var li_w = ''; for(var i=0; i < $('.bannerslider_move').length; i++) { li_cnt = $('.bannerslider_move:eq(' + i + ') li').length; ul_w = 100 * li_cnt + '%'; li_w = 100 / li_cnt + '%'; $('.bannerslider_move:eq(' + i + ')').css('width', ul_w); $('.bannerslider_move:eq(' + i + ') li').css('width', li_w); } } ,left: function() { if(this.flg){ this.flg = false; this.next_cnt = parseInt($('#' + this.target).attr('data-now')) - 1; if(this.next_cnt >= 0){ if(this.next_cnt == 0){ $('#' + $('#' + this.target).attr('data-left')).css('opacity','0.5'); }else{ $('#' + $('#' + this.target).attr('data-left')).css('opacity','1.0'); } $('#' + $('#' + this.target).attr('data-right')).css('opacity','1.0'); mgin = this.next_cnt * 100; $('#' + this.target).animate({ marginLeft: '-' + mgin + '%' },300,'linear',function(){ $('#' + Bannerslide.target).attr('data-now',Bannerslide.next_cnt); Bannerslide.flg = true; }); }else{ Bannerslide.flg = true; } } } ,right: function() { if(this.flg){ this.flg = false; this.next_cnt = parseInt($('#' + this.target).attr('data-now')) + 1; if(this.next_cnt < $('#' + this.target + ' li').length){ if(this.next_cnt == parseInt($('#' + this.target + ' li').length) - 1){ $('#' + $('#' + this.target).attr('data-right')).css('opacity','0.5'); }else{ $('#' + $('#' + this.target).attr('data-right')).css('opacity','1.0'); } $('#' + $('#' + this.target).attr('data-left')).css('opacity','1.0'); mgin = this.next_cnt * 100; $('#' + this.target).animate({ marginLeft: '-' + mgin + '%' },300,'linear',function(){ $('#' + Bannerslide.target).attr('data-now',Bannerslide.next_cnt); Bannerslide.flg = true; }); }else{ Bannerslide.flg = true; } } } }*/ /*------------------------------------------------ 検索ボックス画面切り替え処理 ------------------------------------------------*/ var Searchbox_motion = { init: function() { this.reset_flg = false; this.stay = false; //地方・県TOP、検索結果 if($('#search_wrap.zp_top').size() || $('#search_wrap').size()){ //fixed検索ボタン表示/非表示切り替え this.search_btn_show = false; this.search_btn_switch = false; $(\"#search_wrap input[type='checkbox'], #search_req input[type='checkbox'], .chk_pref\").click(function(){ if(Searchbox_motion.stay){ Searchbox_motion.show_btn(); } }); //一定位置までスクロールした時検索ボタン非表示 $(window).scroll(function(){ if(Searchbox_motion.search_btn_switch){ var limit_height = $('#search_submit_btnwrap').offset(); if(Searchbox_motion.search_btn_show && $(this).scrollTop() + $(this).height() > limit_height.top){ $('#fix_search_btn_wrap').fadeOut(300); Searchbox_motion.search_btn_show = false; }else if(!Searchbox_motion.search_btn_show && $(this).scrollTop() + $(this).height() < limit_height.top){ $('#fix_search_btn_wrap').fadeIn(300); Searchbox_motion.search_btn_show = true; } } }); } //地方・県TOP if($('#search_wrap.zp_top').size()){ //ブロック毎一括チェック処理 $('.chk_block').click(function(evt){ if($(this).parent('.un_sel').length){ return false; } Searchbox_motion.chk_block($(this)); }); //エリアのチェックつけ外し時の処理 $('.chk_area').click(function(){ if($(this).parent('.un_sel').length){ return false; } Searchbox_motion.chk_area($(this)); }); //検索結果 } else if($('#search_wrap').size()){ this.reset_flg = true; //検索チェック済みのlabelにクラス割り当て $(\"#search_wrap .search_check_list_wrap li input[type='checkbox']:checked\").parents('li').addClass('checked_wrap'); //チェックつけ外し時のスタイル処理 $(\"#search_wrap .search_check_list_wrap li input[type='checkbox']\").change(function(){ Searchbox_motion.chk_on_color($(this)); }); /* //pc検索ボックスのサイドにあるタブを押した時の処理 $('.search_tab_switch').click(function(){ if($(this).find('img').hasClass('search_unshift')){ return false; } Searchbox_motion.tab_change($(this)); }); //pcのマップを押した時の処理 $('.map_switch').click(function(){ if($(this).hasClass('un_btn') || $(this).hasClass('map_links')){//NG: return false; return; } Searchbox_motion.map_push($(this)); }); //都道府県に戻るを押した時の処理 $('.back_area_search').click(function(){ Searchbox_motion.back_map($(this)); }); //地方毎一括チェック処理 $('.chk_zone').click(function(evt){ if($(evt.target).closest('.un_sel').length){ return false; } Searchbox_motion.chk_zone($(this)); }); */ //都道府県毎一括チェック処理 $('.chk_pref').click(function(evt){ if($(evt.target).closest('.un_sel').length){ return false; } Searchbox_motion.chk_pref($(this)); }); //ブロック毎一括チェック処理 $('.chk_block').click(function(evt){ if($(this).parent('.un_sel').length){ return false; } Searchbox_motion.chk_block($(this)); }); //エリアのチェックつけ外し時の処理 $('.chk_area').click(function(){ if($(this).parent('.un_sel').length){ return false; } Searchbox_motion.chk_area($(this)); }); //テキストのみに変更した為不要。戻すことになった時のために一応処理残してます //選択済みチェックボックス連動 /*$('.chked_lbl').on('click', function(e) { Searchbox_motion.sync_that = $(this); if(!$(e.target).closest(\"input[type='checkbox']\").length){ $(this).find(\"input[type='checkbox']\").click(); return false; } Searchbox_motion.sync(); }); //選択済みチェックボックス連動 $('.chk_options_lbl').click(function(){ Searchbox_motion.backsync_that = $(this); Searchbox_motion.backsync(); });*/ //チェック全クリア処理 $('#check_clear').click(function(){ Searchbox_motion.chk_allclear(); }); //検索ページ(/[zone]/search/)の検索ボタン表示 /*$(\"#search_wrap input[type='checkbox'], #search_req input[type='checkbox'], .chk_pref\").change(function(){ if(Searchbox_motion.stay){ Searchbox_motion.btn_show(); } });*/ this.aco_flg = true; /* //ゾーンTOPのタブレット以下アコーディオン処理 $('form#search_req .search_opener').on('click', function(evt){ if(!$(evt.target).closest('label').length && !$(evt.target).closest('input').length){ // (2) target = $(this).data('open'); if(target !== ''){ if(!$(this).hasClass('open')){ Searchbox_motion.tb_zone_acodion_open($(this),target); }else{ $(this).parents('.area_searchopener').find('.chk_pref').click(); } } } }); */ //検索ページのアコーディオン処理 $('form#search_wrap .search_opener').on('click', function(evt){ if(!$(evt.target).closest('label').length && !$(evt.target).closest('input').length){ // (2) target = $(this).data('open'); if(target !== ''){ if(!$(this).hasClass('open')){ Searchbox_motion.tb_search_acodion_open($(this),target); }else{ Searchbox_motion.tb_search_acodion_close(); } } } }); //関東・関西を除くエリア検索のタブレット以下アコーディオン処理 $('.open_chk_pref_switch label').click(function(){ if(win_w >= 1000)return; target = $(this).data('open'); if(target !== ''){ if(!$(this).hasClass('open')){ Searchbox_motion.tb_search_chkbox_acodion_open($(this),target); }else{ Searchbox_motion.tb_search_chkbox_acodion_close($(this),target); } } return false; }); /* //ゾーンTOPの検索条件一覧に戻るを押した時の処理 $('.return_search').click(function(){ Searchbox_motion.tb_zone_acodion_close(); Searchbox_motion.chk_allclear(); $('.search_req_submit').attr('data-mode', ''); $('#fix_search_btn_wrap').fadeOut(300,function(){ Searchbox_motion.search_btn_show = false; Searchbox_motion.search_btn_switch = false; $('#search_submit_btnwrap').hide(); }); }); */ //検索ページのエリアタブ切り替え処理 $('.search_tab_opener').click(function(){ Searchbox_motion.chk_area_tab($(this)); }); //検索ページの[エリア/業種/待遇/こだわり]を再選択するを押した時の処理 //NOTE: 地方TOPから、カンタン・キーワード以外のPOST検索をした時のみ表示。 $('.return_zone').click(function(){ Searchbox_motion.save_init_search($(this)); }); } if($('#menu_modal').size()){ $(document).on('click', '#menu_modal input', function () { //検索ボタンを押せなくする $(\"#search_req_submit_fix\").css('pointer-events', 'none'); $(\"#search_req_submit_fix span\").html('検索条件更新中...'); // 「エリア」「業種」「待遇」「こだわり」ポップアップしてるやつを取得する var target = $('#menu_modal form').children('div').filter(':visible').attr('id'); var menu = target.replace(/search_/g, \"\"); //console.log(menu); var pref, block, area, genre, treat, sticking; // prefの値を配列にして、ハイフン区切りで取得する var chk_pref = []; $.each($('#menu_modal input[name=\"chk_pref[]\"]:checked'), function (key, input) { chk_pref.push(input.value); }); var pref = chk_pref.join('-'); // blockの値を配列にして、ハイフン区切りで取得する var chk_block = []; $.each($('#menu_modal input[name=\"chk_block[]\"]:checked'), function (key, input) { chk_block.push(input.value); }); var block = chk_block.join('-'); // エリアの値を配列にして、カンマ区切りで取得する var chk_area = []; $.each($('#menu_modal input[name=\"chk_area[]\"]:checked'), function (key, input) { chk_area.push(input.value); }); var area = chk_area.join(','); if($('#menu_modal input[name=\"contents\"]').val() == 'zone'){ if(menu != 'type' && menu != 'style' && menu != 'cond'){ if($('#menu_modal #search_'+menu+' input[name=\"chk_area[]\"]:checked').length == 0){ $.each($('#menu_modal #search_'+menu+' input[name=\"chk_pref[]\"]'), function (key, input) { chk_pref.push(input.value); }); var pref = chk_pref.join('-'); $.each($('#menu_modal #search_'+menu+' input[name=\"chk_block[]\"]'), function (key, input) { chk_block.push(input.value); }); var block = chk_block.join('-'); $.each($('#menu_modal #search_'+menu+' input[name=\"chk_area[]\"]'), function (key, input) { chk_area.push(input.value); }); var area = chk_area.join(','); } } }else if($('#menu_modal input[name=\"contents\"]').val() == 'pref'){ if($('#menu_modal #search_'+menu+' input[name=\"chk_area[]\"]:checked').length == 0){ $.each($('#menu_modal input[name=\"chk_pref[]\"]'), function (key, input) { chk_pref.push(input.value); }); var pref = chk_pref.join('-'); $.each($('#menu_modal input[name=\"chk_block[]\"]'), function (key, input) { chk_block.push(input.value); }); var block = chk_block.join('-'); $.each($('#menu_modal input[name=\"chk_area[]\"]'), function (key, input) { chk_area.push(input.value); }); var area = chk_area.join(','); } } // 業種の値を配列にして、カンマ区切りで取得する var chk_genre = []; $.each($('#menu_modal input[name=\"chk_genre[]\"]:checked'), function (key, input) { chk_genre.push(input.value); }); var genre = chk_genre.join(','); // 待遇の値を配列にして、カンマ区切りで取得する var chk_treat = []; $.each($('#menu_modal input[name=\"chk_treatment[]\"]:checked'), function (key, input) { chk_treat.push(input.value); }); var treat = chk_treat.join(','); // こだわりの値を配列にして、カンマ区切りで取得する var chk_sticking = []; $.each($('#menu_modal input[name=\"chk_sticking[]\"]:checked'), function (key, input) { chk_sticking.push(input.value); }); var sticking = chk_sticking.join(','); $.ajax({ type: \"POST\", url: \"/api/Search/\", cache: false, data: { zone: $('#menu_modal input[name=\"zone\"]').val() ,pref: pref ,block: block ,area: area ,genre: genre ,treat: treat ,sticking: sticking ,ptn: 1 }, dataType: 'json', success: function(data, dataType){ $('#menu_modal a.search_req_submit').attr('href', data['url']) //検索ボタンを戻す $(\"#search_req_submit_fix\").css('pointer-events', 'auto'); $(\"#search_req_submit_fix span\").html('この条件で検索する'); }, error: function(XMLHttpRequest, textStatus, errorThrown) { //エラーでも戻す $(\"#search_req_submit_fix\").css('pointer-events', 'auto'); $(\"#search_req_submit_fix span\").html('この条件で検索する'); } }); }); } } ,reset: function(act) {//r: resize if(act == 'r' && $('#search_wrap.zp_top').size())return; if(this.reset_flg && ((prev_win_w < '1000' && win_w > '1000') || (prev_win_w > '1000' && win_w < '1000'))){ $('#search_wrap *').removeAttr('style'); } } ,save_init_search: function(that) { var input = $('#search_wrap [name=initial_' + that.data('initial') + ']').val(); if(input){ document.cookie = 'init_search=' + that.data('menu') + '-' + that.data('open') + '-' + that.data('chk') + '-' + input.replace(/,/g, ':') + ';path=/;'; } else { document.cookie = 'init_search=01;path=/;'; } return true; } ,set_init_search: function(cookie) { var start_index = cookie.pos + cookie.name.length; var end_index = cookie.all.indexOf(';', start_index); if(end_index == -1)end_index = cookie.all.length; val = cookie.all.substring(start_index, end_index); if(!val)return;//IE対策 var dir = location.href.split(\"/\"); var zone = dir[dir.length-2]; $('html,body').stop().animate({scrollTop: $('#search_wrap').offset().top}, 50); if(val != '01'){//チェックを表示しない県以外 //data 0: menu番号, 1: 対象モーダル, 2: chk_[name], 3: chk値 var data = val.split('-'); var id = (data[3].indexOf(':') != -1) ? data[3].split(':') : [data[3]]; if(data[2] == 'area'){ $(\".pref_switch[data-target='#search_\" + data[1] + \"']\").click(); } else { $(\".category_switch[data-target='#search_\" + data[1] + \"']\").click(); } /*if(win_w >= 1000){ $(\".search_tab_switch[data-menu='pc_search_menu\" + data[0] + \"']\").click(); if(data[1] != '0')$('#' + data[1]).click(); } else { if(data[1] == '0'){//エリア以外 $('.pc_search_menu' + data[0] + ' .search_opener').click(); } else { if(zone == 'kantou' || zone == 'kansai'){ $('#search_area_list_' + data[1] + ' .search_opener').click(); } else if(data[1]) { var map = data[1].split(\":\"); for(var i=0,length=map.length; i< limit_height.top){ $('#fix_search_btn_wrap').fadeIn(300); } }else if(!checked && this.search_btn_show){ $('#fix_search_btn_wrap').fadeOut(300, function(){ Searchbox_motion.search_btn_show = false; Searchbox_motion.search_btn_switch = false; }); //検索ページのボタンのみ非表示 $('.search_box_box #search_submit_btnwrap').hide(); } } ,chk_area_tab: function(that) { if(that === undefined) { var num = 3; } else { var num = that.attr('data-open'); } var all_chk = ''; var un_chk = ''; $('.tab_search_menu_wrap').css('background-color','#f7f7f7'); that.parent().parent().parent().css('background-color','#ffffff'); $('.search_area_list').hide(); $('#search_area_list_map_' + num).show(); } ,default_tab: function() { if(win_w < 1000)return; var all = $('.tab_search_menu_wrap').length; if(all <= 1)return; var num = 0; i = 0; while(i < all){ var num = $('.tab_search_menu_wrap').eq(i).find('.search_tab_opener').attr('data-open'); if($('#search_area_list_map_' + num).find(\"input[type='checkbox']:checked\").size()){ $('.tab_search_menu_wrap').eq(i).find('.search_tab_opener').click(); break; } i++; } } ,chk_map_btn: function() { var id = ''; var lim = $('.map_btnwrap').length; for(m = 1; m <= lim; m ++){ id = '#search_area_list_map_' + m; all_chk = $(id).find(\"input[type='checkbox']\").length; un_chk = $(id).find('.un_sel').length; if(all_chk == un_chk && un_chk){ $('#map_' + m).addClass('un_btn'); } } } } /*------------------------------------------------ 各種検索条件のアコーディオン処理。値が変更されていれば、 他のアコーディオンを開かせずにsubmitさせる。 ------------------------------------------------*/ var S_accordion = { init: function() { this.e = ''; this.aco_flg = true; this.stay = false; if($('.main_search_opener').size()){ $('.main_search_opener').on('click', function(){ S_accordion.e = $(this); S_accordion.sw(); }); $(\".search_chk_box input[type='checkbox']\").change(function(){ if(S_accordion.stay){ $('.search_chk_box .main_search_opener').attr('data-mode','lock'); } }); this.def_open(); } } ,def_open: function() { if($('#def_open').size() && $('#def_open').val() != ''){ var id = '#' + $('#def_open').val(); $(id + '.main_search_opener').trigger('click'); $('#def_open').val(''); } } //処理振り分け ,sw: function() { var mode = this.e.attr('data-mode'); if(mode == 'lock'){ this.sbmt(); }else if(mode == 'accordion'){ if(this.e.hasClass('open')){ this.close(); }else{ this.open(); } } } //アコーディオン開く、他の開いてるアコーディオンは閉じる ,open: function() { if(this.aco_flg){ this.aco_flg = false; var target = this.e.attr('data-open'); if($('.main_search_opener.open').size()){ $('.search_check_list_wrap').slideUp(300); $('.main_search_opener.open').find('.search_icon_minus').hide(); $('.main_search_opener.open').find('.search_icon_plus').show(); $('.main_search_opener.open').removeClass('open'); } this.e.addClass('open'); this.e.find('.search_icon_plus').hide(); this.e.find('.search_icon_minus').show(); $(target).slideDown(300,function(){ S_accordion.aco_flg = true; }); } } //アコーディオン閉じる ,close: function() { if(this.aco_flg){ this.aco_flg = false; var target = this.e.attr('data-open'); $(target).slideUp(300,function(){ S_accordion.aco_flg = true; }); this.e.removeClass('open'); this.e.find('.search_icon_minus').hide(); this.e.find('.search_icon_plus').show(); } } //ポスト送信、送信する際に押したスイッチのIDをinputに仕込む ,sbmt: function() { if($('.main_search_opener.open').size()){ if(!this.e.hasClass('open')){ $('#def_open').val(this.e.attr('id')); }else{ $('#def_open').val(''); } $('.search_check_list_wrap').slideUp(300,function(){ $('#search_wrap').submit(); }); $('.main_search_opener.open').find('.search_icon_minus').hide(); $('.main_search_opener.open').find('.search_icon_plus').show(); $('.main_search_opener.open').removeClass('open'); }else{ $('#def_open').val(this.e.attr('id')); $('#search_wrap').submit(); } } } /*------------------------------------------------ 検索条件の軸が変更された際のリセット処理 ------------------------------------------------*/ var S_resetter = { init: function() { this.e = ''; if($('.chked_lbl').size()){ //親の検索条件がクリックされた際のリセット処理 $('.search_chk_box .chked_lbl').change(function(){ S_resetter.e = $(this); S_resetter.conditions_reset(); }); } } //親の条件が変更された場合子の条件をリセットする ,conditions_reset: function() { var order = parseInt(this.e.data('order')); if(order == 4){ return; } for(var a = order + 1; a <= 4; a++){ $('#search_chk_box' + a + ' label').prop('checked', false); $('#search_chk_box' + a + ' .chked_lbl').hide(); $('#search_chk_box' + a + ' .default').show(); $('#search_chk_box' + a + ' .main_search_opener').attr('data-mode','lock'); } $('.shop_private_inquiry_form_alert_txt').html(this.e.data('ttl') + 'の条件が変更されたのでリセットされました。'); $('.shop_private_inquiry_form_alert').show(); } } /*------------------------------------------------ 検索ページャー処理 ------------------------------------------------*/ var Serch_chk = { init: function() { if($('#search_wrap,#search_req')){ if(typeof chkprm == 'function'){ chkprm(); } } if($('.search_pager_links').size()){ $('.pager_sw').click(function(){ Serch_chk.that = $(this); Serch_chk.send(); }); $('.pager_link').click(function(){ $(this).find('a')[0].click(); }); } if($('.unlink a').size() || $('.un_sel').size()){ $('.unlink a, .un_sel').click(function(){ return false; }); } } ,chk_set: function() { if(Serch_chk.selectout){ $(Serch_chk.selectout).prop(\"disabled\", true).parent().addClass('un_sel'); if($('.search_area_list .area_search_pref_chk_wrap.un_sel').size()){ $('.search_area_list .area_search_pref_chk_wrap.un_sel').parents('.search_area_list').addClass('no_checked'); } } if(Serch_chk.selected){ $(Serch_chk.selected).prop('checked', true).change(); if($(\".area_srch_chk_list_pref_wrap.hide_chk_wrap\").size()){ var lp = $(\".area_srch_chk_list_pref_wrap.hide_chk_wrap\").length; for (a = 0; a <= lp; a++) { if($(\".area_srch_chk_list_pref_wrap.hide_chk_wrap\").eq(a).find(\"input[type='checkbox']:checked\").size()){ $(\".area_srch_chk_list_pref_wrap.hide_chk_wrap\").eq(a).find(\"input[type='checkbox']\").prop('checked', true); } } } } Searchbox_motion.stay = true; S_accordion.stay = true; if($('.search_tab_opener').size()){ Searchbox_motion.default_tab(); } } ,send: function() { $.when( Searchbox_motion.chk_allclear(), chkprm(), $('#pager_inp').val(Serch_chk.that.data('page')) ).done(function(){ $('#search_wrap').submit() }); } } /*------------------------------------------------ 検索フォーム送信(地方・県TOP) ------------------------------------------------*/ var Search_zone = { init: function() { Search_zone.e = ''; if($('#search_req_submit_unfix').size() || $('#search_req_submit_fix').size()){ $('#search_req_submit_unfix, #search_req_submit_fix').click(function(){ Search_zone.e = $(this); Search_zone.sw(); }); } } ,sw: function() { $.when( Search_zone.chk_load() ).done(function(){ Search_zone.sbmit() }); } ,chk_load: function() { var mode = Search_zone.e.data('mode'); var pref = ''; if(typeof Search_zone.e.data('pref') !== 'undefined'){ pref = Search_zone.e.data('pref'); } var only = ''; //alert('mode: '+mode+', pref: '+pref); if(mode == 'type' || mode == 'style' || mode == 'cond'){ only = '#search_' + mode; $(\".search_other_box:not(\" + only + \") input[type='checkbox']\").prop('checked', false); if(pref != ''){//pref top $(\".search_pref_box input[type='checkbox']:enabled\").prop('checked', true); }else{ $(\".search_pref_box input[type='checkbox']\").prop('checked', false); } }else if(mode != ''){ only = \"#search_\" + mode; if($(only + \" input[type='checkbox']:checked\").size() == 0){ $(only + \" input[type='checkbox']:enabled\").prop('checked', true);//.change(); } $(\".search_pref_box:not(\" + only + \") input[type='checkbox']\").prop('checked', false); $(\".search_other_box input[type='checkbox']\").prop('checked', false); }else{ return; } } ,sbmit: function() { $('#search_req').submit(); } ,validation: function() { if ($('#search_req').find(\"input[type='checkbox']:checked\").size() == 0) { alert('最低1つはチェックして下さい。'); return false; } return true; } } /*------------------------------------------------ 検索フォーム送信(検索ページ) ------------------------------------------------*/ var Search_form = { init: function() { if($('#search_wrap_submit_fix').size() || $('#search_wrap_submit_unfix').size()){ $('#search_wrap_submit_fix, #search_wrap_submit_unfix').click(function(){ Search_form.submit(); }); } } ,submit: function() { //バリデーションチェック if(!Search_form.validation())return; //ボタン押下 $('#search_wrap').submit(); } ,validation: function() { if ($('#search_wrap').find(\"input[type='checkbox']:checked\").size() == 0) { alert('最低1つはチェックして下さい。'); return false; } return true; } } /*------------------------------------------------ input プレースホルダー処理 inputタグのクラス名に「input_placeholder」 プレースホルダーに見せるテキスト、アイコン等のタグに「placeholder」 「.input_placeholder」に「data-placeholder」属性を付ける 「.placeholder」に「data-input」属性を付ける 「data-placeholder」属性には「.placeholder」のクラス名、id名。 「data-input」属性には「.input_placeholder」のクラス名、id名。 例：フリーワード店舗検索 ------------------------------------------------*/ var Text_placeholder = { init: function() { if($('.input_placeholder').size()){ $('.placeholder').click(function(){ Text_placeholder.input = $($(this).attr('data-input')); Text_placeholder.placeholder = $($(this).attr('data-placeholder')); Text_placeholder.on_placeholder(); }); $('.input_placeholder').focus(function(){ Text_placeholder.input = Text_placeholder.input = $(this); Text_placeholder.placeholder = $($(this).attr('data-placeholder')); Text_placeholder.on_cursor(); }); $('.input_placeholder').blur(function(){ Text_placeholder.input = Text_placeholder.input = $(this); Text_placeholder.placeholder = $($(this).attr('data-placeholder')); Text_placeholder.out_cursor(); }); //キャッシュ等による初期値があればプレースホルダ消す。 this.initial_val_check(); } } ,on_placeholder: function() { this.placeholder.hide(); this.input.focus(); } ,on_cursor: function() { this.placeholder.hide(); } ,out_cursor: function() { if(this.input.val() === ''){ this.placeholder.show(); } } ,initial_val_check: function() { var lp = $('.input_placeholder').length; for (a = 0; a <= lp; a++) { if($('.input_placeholder').eq(a).val() !== ''){ $('.input_placeholder').eq(a).focus(); $('.input_placeholder').eq(a).blur(); } } } } /*------------------------------------------------ 店舗詳細各種処理 ------------------------------------------------*/ var Shop_page = { init: function() { this.flg = false; //戻るボタンイベント $(window).on('popstate', function() { if(location.hash != \"\")return; Shop_page.modal_close();// 電話、直メ、LINE、gmap if(Shop_page.photoflg){// photo gallery Shop_page.photoflg = false; Shop_page.gallery_modal_off(); } }); //フォーカスの取得 $('#name, #age, #keiken_exp, #keiken_inexp, #mail, #message').focusin(function() { Shop_page.fixhide(); }); //NOTE: 無料でも出すように変更 this.tool_tip(); if($('#paid_shop_data').size()){ //if($('#inquiry_list_wrap').size()){ this.flg = true; this.scrl_flg = true; this.fix_flg = true; this.timerId = false; this.stop_flg = true; this.photo_e = ''; this.photoflg = true; if($('#shop_l_img').size()){ var elm = $('#shop_l_img'); this.img_top = elm.offset().top; this.img_h = parseInt(elm.height()); } //NOTE: 無料でも出すように変更 //this.tool_tip(); //スクロール時処理 $(window).scroll(function(){ if(win_w >= 900){ Shop_page.scrl_top = parseInt($(this).scrollTop()); if($('#kentotyu_wrap').size()){ Shop_page.start_fix_pos = parseInt($('#kentotyu_wrap').offset().top) + parseInt($('#kentotyu_wrap').outerHeight(true)); } else {//for official Shop_page.start_fix_pos = parseInt($('#slider_wrap').outerHeight(true)) + 20; } Shop_page.fotter_pos = parseInt($('footer').offset().top); Shop_page.fix_inq_btm = Math.abs(Shop_page.scrl_top) + parseInt($('#inquiry_list_wrap').outerHeight(true)); if(Math.abs(Shop_page.scrl_top) > Math.abs(Shop_page.start_fix_pos) && Math.abs(Shop_page.fix_inq_btm) <= Math.abs(Shop_page.fotter_pos)){ Shop_page.side_inq_fix(); }else if(Shop_page.scrl_flg && Math.abs(Shop_page.scrl_top) <= Math.abs(Shop_page.start_fix_pos)){ Shop_page.side_inq_free(); }else if(Math.abs(Shop_page.fix_inq_btm) >= Math.abs(Shop_page.fotter_pos)){ Shop_page.side_inq_fix_bottom(); } }else if(win_w < 620){ Shop_page.fixhide(); var id = $(\":focus\").attr(\"id\"); //alert(id); if(id !== undefined)return; if (this.timerId) { clearTimeout(this.timerId); } // 0.5秒間スクロールしない場合 this.timerId = setTimeout(function () { this.timerId = false; Shop_page.fixshow(); }, 500); } }); $(\"#shop_inquiry input[type='text'], #shop_inquiry textarea\").on({ 'focus': function() { Shop_page.txt_focus(); }, 'blur': function() { Shop_page.txt_out_focus(); } }); //有料掲載向けのハッシュとモーダル表示（無料はaタグにいれている） $('#inq_tell, #sp_inq_tell, #tb_inq_tell, .under_inq_tell, .sp_under_inq_tell').on('click', function(){ if(typeof $(this).data('event') !== 'undefined'){ Shop_page.send_event($(this), 'tell'); }else{ location.hash = \"#modal_tell\"; Shop_page.modal_on('tell'); } }); $('#inq_mail, #sp_inq_mail, #tb_inq_mail, .under_inq_mail, .sp_under_inq_mail').on('click', function(){ if(typeof $(this).data('event') !== 'undefined'){ Shop_page.send_event($(this), 'mail'); }else{ location.hash = \"#modal_mail\"; Shop_page.modal_on('mail'); } }); $('#inq_line, #sp_inq_line, #tb_inq_line, .under_inq_line, .sp_under_inq_line').on('click', function(){ if(typeof $(this).data('event') !== 'undefined'){ Shop_page.send_event($(this), 'line'); }else{ location.hash = \"#modal_line\"; Shop_page.modal_on('line'); } }); $('#map_on').click(function(){ location.hash = \"#modal_map\"; Shop_page.modal_on('map'); }); //フォトギャラリー $('.modal_photo_sw').on('click',function(){ location.hash = \"#modal_pg\";//#modal_photoだと不具合が起きます if(Shop_page.photoflg){ Shop_page.photoflg = false; Shop_page.photo_e = $(this); Shop_page.gallery_modal_on(); } }); $(window).resize(function(){ if(win_w !== prev_win_w && $('#photo_modal_wrap').css('display') == 'block'){ Shop_page.gallery_modal_off(); } }); $('#photo_left').on('click',function(){ if(Shop_page.photoflg){ if(Shop_page.photo_e.parents('.photo_onece').prev('.photo_onece').find('.modal_photo_sw').size()){ Shop_page.photoflg = false; Shop_page.gallery_modal_off('left'); } } }); $('#photo_right').on('click',function(){ if(Shop_page.photoflg){ if(Shop_page.photo_e.parents('.photo_onece').next('.photo_onece').find('.modal_photo_sw').size()){ Shop_page.photoflg = false; Shop_page.gallery_modal_off('right'); } } }); $('#photo_modal_back, #mdl_close_btn').on('click',function(){ if(Shop_page.photoflg){ Shop_page.photoflg = false; Shop_page.gallery_modal_off(); } }); } if($('.shop_data_wrap').size()){ //this.text_h = $('#shop_main_txt_p').outerHeight(); this.text_h = $('#shop_main_txt').get(0).scrollHeight; this.before_h = (win_w <= 620) ? 305 : 1037; //console.log(this.text_h + ', ' + this.before_h); if(this.text_h > this.before_h){ $('.shop_txt_more_wrap').show(); } if($('.ga_evt').size()) { $('.ga_evt').on('click', function(e){ e.preventDefault(); Shop_page.send_event($(this), ''); Shop_page.send_cv($(this), ''); }); } if($('.shop_link').size()) { $('.shop_link').on('click', function(e){ e.preventDefault(); Shop_page.send_event($(this), 'shop'); }); } $('#shop_txt_more').click(function(){ Shop_page.shop_txt_more(); }); $('#shop_txt_close').click(function(){ Shop_page.shop_txt_close(); }); $('#modal_back, #photo_modal_back, #mdl_close_btn, .modal_close').click(function(){ if(location.hash != \"\"){ history.back(); } Shop_page.modal_close(); }); } } ,send_event: function(that, mode) { //console.log(that.data('event'), that.data('shop'), that.attr('href')); //Text link, Footer, Modal if(that.data('event') && that.data('shop') && that.attr('href')) { var is_ext = (typeof that.attr('target') !== 'undefined' && that.attr('target') == '_blank') ? true : false; var label = (typeof that.data('label') !== 'undefined') ? that.data('label') : ''; //var value = ''; if(is_ext && mode == 'shop'){ //ポップアップブロック防止のため、非同期でページ遷移させない ga('send', 'event', that.data('event'), that.data('shop'), label); Shop_page.click_count(that, is_ext); window.open(that.attr('href'), \"_blank\"); }else if(that.attr('href').match(/mailto:/) !== null || that.attr('href').match(/tel:/) !== null){ //警告が出るため、非同期でリンクに飛ばさない ga('send', 'event', that.data('event'), that.data('shop'), label); location.href = that.attr('href'); }else{ ga('send', 'event', that.data('event'), that.data('shop'), label, { hitCallback: Link_block.create_func_widh_timeout(function() { //console.log(\"2:event sended!\"); if(mode == 'shop'){ Shop_page.click_count(that, is_ext); }else if(mode == 'tell' || mode == 'mail' || mode == 'line'){ location.hash = \"#modal_\" + mode; Shop_page.modal_on(mode); }else if(mode == \"\"){ location.href = that.attr('href'); } }) }); } } } ,send_cv: function(that, mode) { //console.log(that.data('event'), that.data('shop'), that.attr('href')); $.ajax({ type: \"POST\", url: \"/api/CvCount/\", cache: false, data: { zone: that.data('zone') ,device: that.data('device') ,shop_id: that.data('shop_id') ,type: that.data('type') ,official: that.data('official') }, success: function(data, dataType){ }, error: function(XMLHttpRequest, textStatus, errorThrown) { } }); } ,click_count: function(that, is_ext) { //計測とクリック(HP) $.ajax({ type: \"POST\", url: \"/api/BannerCount/\", cache: false, data: { zone: that.data('zone') ,device: that.data('device') //,case: 'click' ,type: 'shop' ,id: that.data('id') }, success: function(data, dataType){ if(!is_ext){ location.href = that.attr('href'); } }, error: function(XMLHttpRequest, textStatus, errorThrown) { //エラーでも遷移させる if(!is_ext){ location.href = that.attr('href'); } } }); //そのままaタグに流す //return true; } ,tool_tip: function() { var targets = $('[rel~=tooltip]'), target = false, tooltip = false, title = false; targets.bind('mouseenter', function(){ target = $(this); tip = target.attr('title'); tooltip = $(''); if(!tip || tip == '') return false; target.removeAttr('title'); tooltip.css('opacity', 0) .html(tip) .appendTo('body'); var init_tooltip = function(){ if($(window).width() < tooltip.outerWidth() * 1.5) tooltip.css('max-width', $(window).width() / 2); else tooltip.css('max-width', 340); var pos_left = target.offset().left + (target.outerWidth() / 2) - (tooltip.outerWidth() / 2), pos_top = target.offset().top - tooltip.outerHeight() - 20; if(pos_left < 0) { pos_left = target.offset().left + target.outerWidth() / 2 - 20; tooltip.addClass('left'); } else tooltip.removeClass('left'); if(pos_left + tooltip.outerWidth() > $(window).width()) { pos_left = target.offset().left - tooltip.outerWidth() + target.outerWidth() / 2 + 20; tooltip.addClass('right'); } else tooltip.removeClass('right'); if(pos_top < 0) { var pos_top = target.offset().top + target.outerHeight(); tooltip.addClass('top'); } else tooltip.removeClass('top'); tooltip.css({ left: pos_left, top: pos_top }) .animate({ top: '+=10', opacity: 1 }, 50); }; init_tooltip(); $(window).resize(init_tooltip); var remove_tooltip = function(){ tooltip.animate({ top: '-=10', opacity: 0 }, 50, function(){ $(this).remove(); }); target.attr('title', tip); }; target.bind('mouseleave', remove_tooltip); tooltip.bind('click', remove_tooltip); $(window).bind('scroll', remove_tooltip); }); } ,side_inq_fix: function() { if($('#kentotyu_wrap').size()){ var side_top = this.scrl_top - $('#kentotyu_wrap').offset().top; } else {//for official var side_top = this.scrl_top - ($('#slider_wrap').outerHeight(true) + 20); } $('#inquiry_list_wrap').css('top', side_top + 'px').addClass('changed'); if($('.contents_shop_navi dl').size()){ $('.contents_shop_navi dl').css('top', side_top + 'px').addClass('changed'); } this.scrl_flg = true; } ,side_inq_free: function() { $('#inquiry_list_wrap').css('top', ''); if($('.contents_shop_navi dl').size()){ $('.contents_shop_navi dl').removeAttr('style'); } this.scrl_flg = false; } ,side_inq_fix_bottom: function() { var relate = $('.contents_right_wrap').offset().top; var top_num = this.fotter_pos - relate - parseInt($('#inquiry_list_wrap').outerHeight(true)) - 20; $('#inquiry_list_wrap').css('top', top_num + 'px').addClass('changed'); this.scrl_flg = true; } ,shop_txt_more: function() { $('#shop_main_txt').css('max-height', 'unset'); $('#shop_main_txt').animate({ maxHeight : this.text_h + 'px' },300,function(){ $('#shop_txt_more').hide().addClass('changed'); $('#shop_txt_close').css('display','inline').addClass('changed'); $('#shop_main_txt').addClass('changed'); }); } ,shop_txt_close: function() { $('#shop_main_txt').animate({ maxHeight : this.before_h + 'px' },300,function(){ $('#shop_txt_close').hide().addClass('changed'); $('#shop_txt_more').css('display','inline').addClass('changed'); $('#shop_main_txt').addClass('changed'); var top = $('.shop_data_box').offset().top; $('body, html').animate({ scrollTop: top}, 300); }); } ,modal_on: function(mode) { $('.modal_contents').hide(); $('#modal_contents_' + mode).show(); $('#modal_back, #modal_wrap').fadeIn(300); var height = (parseInt($('#modal_wrap').height()) / 2) * -1; $('#modal_wrap').css('margin-top',height + 'px'); } ,modal_close: function(mode) { $('#modal_back, #modal_wrap').fadeOut(300); } ,reset: function() { if(this.flg){ if($('.changed').length != '0'){ $('.changed').removeAttr('style').removeClass('.changed'); } } } ,fixhide: function() { if(this.fix_flg){ this.fix_flg = false; //$('#shop_top_fixed').slideUp(100).addClass('changed'); } } ,fixshow: function() { if($(window).scrollTop() > 0){ //$('#shop_top_fixed').slideDown(100).addClass('changed'); this.fix_flg = true; } } ,txt_focus: function() { this.stop_flg = false; $('.tb_inquiry_list_wrap').hide().addClass('changed'); } ,txt_out_focus: function() { this.stop_flg = true; setTimeout(function() { if(!Shop_page.stop_flg)return false; $('.tb_inquiry_list_wrap').removeAttr('style').addClass('changed'); }, 300); } //フォトギャラリーモーダル表示処理 ,gallery_modal_on: function() { this.img = ''; this.photo_src = ''; this.next_photo = ''; this.prev_photo = ''; var cap = ''; this.img = new Image(); //画像が読み込まれたら処理実行 this.img.onload=function(){ var img_w = 0; var img_h = 0; var n_f_w = 0; var n_f_h = 0; var f_ml = 0; var f_mt = 0; if(win_w >= 1000){ var pd = 60; var max_w = 470; var max_h = 400; }else if(win_w >= 620){ var pd = 50; var max_w = 550; var max_h = 520; }else{ var pd = 40; var max_w = 250; var max_h = 260; } //画像生のサイズ取得 img_w = parseInt(Shop_page.img.width); img_h = parseInt(Shop_page.img.height); if(img_w == 0 || img_h == 0){ Shop_page.photoflg = true; return; } //画像入れ込んだ際のモーダルのフレーム横縦幅算出 var f_w = (img_w + pd); var f_h = (img_h + 110); //ウインドウ幅とモーダルのフレームの差分算出 var diff_w = max_w - f_w; var diff_h = max_h - f_h; //レスポンシブの為画像の横、縦の内、画面サイズ一杯になっている場合画像サイズ縮小 if(diff_w <= 10 || diff_h <= 10){ //横幅と縦幅で画面サイズをより超えている方をサイズ変更 if(diff_w <= diff_h){//横幅基準 //画面サイズに収まる横幅に調整 n_f_w = max_w; //横幅の変化させた比率で縦幅算出 n_f_h = Math.round((n_f_w * img_h) / img_w); //求めた数値に変更 img_w = n_f_w; img_h = n_f_h; //枠再計算 f_w = (img_w + pd); //横幅変更 $('#big_photo').css('width',img_w + 'px'); }else{//縦幅基準 //画面サイズに収まる縦幅に調整 n_f_h = max_h; //縦幅の変化させた比率で横幅算出 n_f_w = Math.round((n_f_h * img_w) / img_h); //求めた数値に変更 img_w = n_f_w; img_h = n_f_h; //枠再計算 f_w = (img_w + pd); //縦幅変更 $('#big_photo').css('height',img_h + 'px'); } } //背景表示 $('#photo_modal_back').fadeIn(100); //横幅指定 $('#photo_modal_wrap').css({'width': f_w + 'px','opacity': '0'}).show().css({ 'margin-left': f_w / 2 * -1 + 'px' ,'margin-top': parseInt($('#photo_modal_wrap').outerHeight()) / 2 * -1 + 'px' }).animate({opacity: 1},100,function(){ //フラグ変更 Shop_page.photoflg = true; }); } $('#big_photo').bind(\"load\", function(){ //画像を読み込み、処理実行 Shop_page.img.src = Shop_page.photo_src; //クリックイベント内にイベントを記述しているため、 //クリックの度に増殖する。そのためunbind $('#big_photo').unbind('load'); }); //画像パス取得 this.photo_src = this.photo_e.data('src'); //画像をモーダル上に表示 $('#big_photo').attr('src', '');//iPhoneで同じURLだとイベントが発火しないため初期化 $('#big_photo').attr('src', this.photo_src); //キャプション取得 cap = this.photo_e.parents('.photo_onece').find('.caption').text(); //キャプションをモーダル上に表示 $('#modal_capt').text(cap); //次、前が無い時はそれぞれ矢印消す if(!this.photo_e.parents('.photo_onece').next('.photo_onece').size()){ $('#photo_right').hide(); }else{ $(' '); } if(!this.photo_e.parents('.photo_onece').prev('.photo_onece').size()){ $('#photo_left').hide(); }else{ $(' '); } } ,gallery_modal_off: function(flg) { if(flg != 'right' && flg != 'left'){ $('#photo_modal_back').fadeOut(100); } $('#photo_modal_wrap').fadeOut(100,function(){ $('#photo_left,#photo_right').show().removeAttr('style'); $('#big_photo').css('width','auto').css('height','auto').removeAttr('style'); $('#photo_modal_wrap').css({ 'margin-left': '0px' ,'margin-top': '0px' }); Shop_page.photoflg = true; if(flg === 'right'){ Shop_page.photo_e.parents('.photo_onece').next('.photo_onece').find('.modal_photo_sw').click(); }else if(flg === 'left'){ Shop_page.photo_e.parents('.photo_onece').prev('.photo_onece').find('.modal_photo_sw').click(); } }); } } /*------------------------------------------------ 「もっと見る」ボタン （店舗詳細、検索結果・検討中・閲覧済・応募済の店舗一覧） ------------------------------------------------*/ /*var Morebtn = { init: function() { this.flg = false; if($('.more_btn').size()){ this.flg = true; $('.more_btn').click(function(){ Morebtn.more_btn($(this)); }); $('.close_btn').click(function(){ Morebtn.close_btn($(this)); }); } } ,more_btn: function(that) { var target = that.attr('data-target'); $(target).slideDown(300).addClass('changed'); that.hide().addClass('changed') .parent().find('.close_btn').css('display','inline').addClass('changed'); } ,close_btn: function(that) { var target = that.attr('data-target'); $(target).slideUp(300).addClass('changed'); that.hide().addClass('changed') .parent().find('.more_btn').css('display','inline').addClass('changed'); if(that.hasClass('top_back')){//店舗詳細用 var head = parseInt($('#shop_top_fixed').height()); var anchor = that.parents('.shop_info_block').attr(\"id\"); var target_offset = $('#'+anchor).offset().top; $('html,body').stop().animate({scrollTop: target_offset - (head + 20)}, 300); } } ,reset: function() { if(this.flg){ if($('.changed').length != '0'){ $('.changed').removeAttr('style').removeClass('.changed'); } } } }*/ /*------------------------------------------------ 問合せフォーム送信 ------------------------------------------------*/ var Toiawase = { init: function() { if($('#toiawase_req_submit_unfix, #toiawase_req_submit_unfix_sp').size()){ $('#toiawase_req_submit_unfix, #toiawase_req_submit_unfix_sp').click(function(){ //NOTE: hashはhtml側で抽出している $('#toiawase.'+hash).submit(); }); //掲載希望エリア Toiawase.Affiliated.init(); if(typeof area_start_up_zone == 'function'){ area_start_up_zone(); } } } ,Affiliated: { init: function() { //events $('#zone-'+hash).on('change', Toiawase.Affiliated.step1); $('#pref-'+hash).on('change', Toiawase.Affiliated.step2); $('#block-'+hash).on('change', Toiawase.Affiliated.step3); //初期化非表示 $('#pref-'+hash).css(\"display\", \"none\"); $('#block-'+hash).css(\"display\", \"none\"); $('#area-'+hash).css(\"display\", \"none\"); } ,step1: function() { if(!$('#zone-'+hash+' option:selected').data('code')) { //初期化非表示 $('#pref-'+hash).css(\"display\", \"none\"); $('#block-'+hash).css(\"display\", \"none\"); $('#area-'+hash).css(\"display\", \"none\"); return; } else { //初期化リセット $('#block-'+hash+' option').remove(); $('#block-'+hash).append('お選びください'); $('#area-'+hash+' option').remove(); $('#area-'+hash).append('お選びください'); $('#block-'+hash).css(\"display\", \"none\"); $('#area-'+hash).css(\"display\", \"none\"); } var dfd = $.Deferred(); $.ajax({ type: \"GET\", url: \"/api/AffiliatedArea/\", cache: false, data: {zone: $('#zone-'+hash+' option:selected').data('code')}, success: function(data, dataType){ if(data == \"false\")alert(\"システムエラー:Toiawase.Affiliated.step1\"); //初期化リセット $('#pref-'+hash+' option').remove(); $('#pref-'+hash).append('お選びください'); //リスト生成 var list = $.parseJSON(data); for (var i in list) { console.log(list[i].name); $('#pref-'+hash).append(''+list[i].name+''); } //表示 $('#pref-'+hash).css(\"display\", \"inline\"); dfd.resolve(); }, error: function(XMLHttpRequest, textStatus, errorThrown) { dfd.reject(); } }); return dfd.promise(); } ,step2: function() { if(!$('#pref-'+hash+' option:selected').data('code')) { //初期化非表示 $('#block-'+hash).css(\"display\", \"none\"); $('#area-'+hash).css(\"display\", \"none\"); return; } else { //初期化リセット $('#area-'+hash+' option').remove(); $('#area-'+hash).append('お選びください'); $('#area-'+hash).css(\"display\", \"none\"); } var dfd = $.Deferred(); $.ajax({ type: \"GET\", url: \"/api/AffiliatedArea/\", cache: false, data: { zone: $('#zone-'+hash+' option:selected').data('code'), pref: $('#pref-'+hash+' option:selected').data('code') }, success: function(data, dataType){ if(data == \"false\")alert(\"システムエラー:Toiawase.Affiliated.step1\"); //初期化リセット $('#block-'+hash+' option').remove(); $('#block-'+hash).append('お選びください'); //リスト生成 var list = $.parseJSON(data); for (var i in list) { console.log(list[i].name); $('#block-'+hash).append(''+list[i].name+''); } //表示 $('#block-'+hash).css(\"display\", \"inline\"); dfd.resolve(); }, error: function(XMLHttpRequest, textStatus, errorThrown) { dfd.reject(); } }); return dfd.promise(); } ,step3: function() { if(!$('#block-'+hash+' option:selected').data('code')) { //初期化非表示 $('#area-'+hash).css(\"display\", \"none\"); return; } var dfd = $.Deferred(); $.ajax({ type: \"GET\", url: \"/api/AffiliatedArea/\", cache: false, data: { zone: $('#zone-'+hash+' option:selected').data('code'), pref: $('#pref-'+hash+' option:selected').data('code'), block: $('#block-'+hash+' option:selected').data('code') }, success: function(data, dataType){ if(data == \"false\")alert(\"システムエラー:Toiawase.Affiliated.step1\"); //初期化リセット $('#area-'+hash+' option').remove(); $('#area-'+hash).append('お選びください'); //リスト生成 var list = $.parseJSON(data); for (var i in list) { console.log(list[i].name); $('#area-'+hash).append(''+list[i].name+''); } //表示 $('#area-'+hash).css(\"display\", \"inline\"); dfd.resolve(); }, error: function(XMLHttpRequest, textStatus, errorThrown) { dfd.reject(); } }); return dfd.promise(); } } } /*------------------------------------------------ クレームメールフォーム送信 ------------------------------------------------*/ var Claim = { init: function() { if($('#pc_claim_submit, #sp_claim_submit').size()){ $('#pc_claim_submit, #sp_claim_submit').click(function(){ $('#claim').submit(); }); } } }; /*------------------------------------------------ 情報提供フォーム送信 ------------------------------------------------*/ var Feedback = { init: function() { if($('#pc_feedback_submit, #sp_feedback_submit').size()){ $('#pc_feedback_submit, #sp_feedback_submit').click(function(){ $('#feedback').submit(); }); } } }; /*------------------------------------------------ カンタン検索フォーム送信(地方・県TOP) ------------------------------------------------*/ var Search_easy = { init: function() { if($('#easy_submit').size()){ $('#easy_submit').click(function(){ if(Search_easy.validation()){ //$('#easy_search').submit(); Search_easy.redirection(); } }); $('#tb_easy_submit').click(function(){ if(Search_easy.tb_validation()){ //$('#tb_easy_search').submit(); Search_easy.redirection(); } }); } } ,validation: function() { if ($('#easy_area').val() == '' && $('#easy_type').val() == ''){ alert('エリアまたは業種を選択してください。'); return false; } return true; } ,tb_validation: function() { //NOTE: こちら使われてないかも if ($('#tb_easy_area').val() == '' && $('#tb_easy_type').val() == ''){ alert('エリアまたは業種を選択してください。'); return false; } //タブレットや狭めたPCブラウザで問題が起きるので廃止 //if(!$('input[name=easy_area_code]').val() && !$('input[name=easy_type_code]').val()) { //alert('エリアまたは業種を選択してください。'); //return false; //} return true; } ,redirection: function() { //PC～TB版 if( !($('#easy_area option:selected').val() == 0 && $('#easy_type option:selected').val() == 0) ) {//SP版の時にPChtmlを拾ってしまうため if($('#easy_area option:selected').val() && $('#easy_type option:selected').val()) { location.href = \"/\" + Easy_search_out.zone + \"/\" + $('#easy_area option:selected').val() + \"_\" + $('#easy_type option:selected').val() + \".html?kantan\"; return; } else if ($('#easy_area option:selected').val()) { location.href = \"/\" + Easy_search_out.zone + \"/\" + $('#easy_area option:selected').val() + \".html?kantan\"; return; } else if ($('#easy_type option:selected').val()) { //pref top var area_opt = (Easy_search_out.pref != '') ? 'area_' + Easy_search_out.pref + '_' : ''; location.href = \"/\" + Easy_search_out.zone + \"/\" + area_opt + $('#easy_type option:selected').val() + \".html?kantan\"; return; } } /* //TB版 if( !($('#tb_easy_area option:selected').val() == 0 && $('#tb_easy_type option:selected').val() == 0) ) {//SP版の時にTBhtmlを拾ってしまうため if($('#tb_easy_area option:selected').val() && $('#tb_easy_type option:selected').val()) { location.href = \"/\" + Easy_search_out.zone + \"/\" + $('#tb_easy_area option:selected').val() + \"_\" + $('#tb_easy_type option:selected').val() + \".html\"; return; } else if ($('#tb_easy_area option:selected').val()) { location.href = \"/\" + Easy_search_out.zone + \"/\" + $('#tb_easy_area option:selected').val() + \".html\"; return; } else if ($('#tb_easy_type option:selected').val()) { location.href = \"/\" + Easy_search_out.zone + \"/\" + $('#tb_easy_type option:selected').val() + \".html\"; return; } } */ //SP版 if($('input[name=easy_area_code]').val() && $('input[name=easy_type_code]').val()) { location.href = \"/\" + Easy_search_out.zone + \"/\" + $('input[name=easy_area_code]').val() + \"_\" + $('input[name=easy_type_code]').val() + \".html?kantan\"; return; } else if ($('input[name=easy_area_code]').val()) { location.href = \"/\" + Easy_search_out.zone + \"/\" + $('input[name=easy_area_code]').val() + \".html?kantan\"; return; } else if ($('input[name=easy_type_code]').val()) { //pref top var area_opt = (Easy_search_out.pref != '') ? 'area_' + Easy_search_out.pref + '_' : ''; location.href = \"/\" + Easy_search_out.zone + \"/\" + area_opt + $('input[name=easy_type_code]').val() + \".html?kantan\"; return; } else { alert('エリアまたは業種を選択してください。'); } return false; } } /*------------------------------------------------ 店舗非公開問合せ ------------------------------------------------*/ Inq_prv_shop = { init: function() { if($('#pc_shop_submit').size() || $('.form_wrap #shop_private_inquiry_wrap').size()) { if($('.shop_private_inquiry_form_alert').size()) { Go_to.go('#shop_private_inquiry_wrap', true, 'slow'); } $('#pc_shop_submit, #sp_shop_submit').on('click', function(){ /*if($('#shop-paid.official').size() || $('#shop-paid.official_disp').size()) {//for official Inq_prv_shop.async_send(); } else */ if($('#shop_inquiry').size()) { $('#shop_inquiry').submit(); } else if ($('#shop_all_inquiry').size()) { $('#shop_all_inquiry').submit(); } }); } if($('#pc_inc_submit').size()){ $('#pc_inc_submit, #sp_inc_submit').on('click', function(){ $('#shop_inquiry').submit(); }); } } /*,async_send: function() { var form = $('#shop_inquiry').get()[0]; var formData = new FormData(form); formData.append('zone', $('#zone_code').val()); formData.append('shop_id', $('#shop_id').val()); $.ajax({ type: \"POST\", url: \"/api/OuboMail/\", cache: false, data: formData, dataType: 'json', processData: false, contentType: false, success: function(data, dataType){ if(data.status == \"OK\") { $.when( $('.shop_private_bd_back').remove(), $('#form_container').append(data.message) ).done(function(){ Go_to.go('#shop_private_inquiry_wrap', true) }); } else { //リセット $(\".shop_private_inquiry_form_alert\").remove(); $(\"#shop_inquiry input[type='text'], #shop_inquiry select, #shop_inquiry textarea\").removeAttr('style'); $(\"#shop_inquiry input[type='text']\").css('box-shadow', '0 0 0 99px #fff inset'); var content = ''; if(data.error == \"duplicate\") { content += \"×このお問い合せ内容は送信済みです。\"; } else if(data.error == \"file_error\") { content += data.file_err; } else if(data.error == \"ERROR_MAIL_NEGATIVE\") { content += \"×このメールアドレスでは応募できません。ご確認ください。\"; } else { content += \"×入力の内容に誤りがあります。ご確認ください。\"; } content += ''; $('.shop_private_inquiry_form_submit_wrap').before(content); for (var item in data.err_style) { $('#' + item).attr('style', data.err_style[item]); } Go_to.go('#shop_private_inquiry_wrap', true); } }, error: function(XMLHttpRequest, textStatus, errorThrown) { alert('通信エラーが発生しました。\\n申し訳ございませんが、しばらくたってから再度お試し下さい。'); } }); }*/ }; var Test_mail = { init: function() { if($('#send_test').size()) { $('#send_test').on('click', Test_mail.send); } } ,send: function() { if(!$(this).hasClass('active'))return; var mail = ''; var sendable = false; if($('#mail1').val() && $('#mail2').val()) { mail = $('#mail1').val() + \"@\" + $('#mail2').val(); sendable = true; } else if($('#mail1').val() && (typeof $('#mail2').val() === 'undefined')) {//claim mail = $('#mail1').val(); sendable = true; } if(!sendable) { alert(\"メールアドレスをご入力ください。\"); return false; } $.ajax({ type: \"POST\", url: \"/api/TestMail/\", cache: false, data: {'mail': mail}, dataType: 'json', success: function(data, dataType){ //console.log(data); if(data == \"true\") { alert(mail + \" 宛にメールをお送りしました。\\nご確認をお願いします。\"); } else if(data.indexOf('false:') !== -1) { var msg = data.split(':'); if(msg[1] == 'ERROR_MAIL_NEGATIVE') { alert('このメールアドレスでは送信できません。'); } } else { alert('有効なメールアドレスが入力されていません。'); } }, error: function(XMLHttpRequest, textStatus, errorThrown) { console.log(\"bbb\"); } }); } }; //はじめての方へ var Beginner = { init: function() { if($('.pink_bd_box ul li a img').size())$('.pink_bd_box ul li a img').hover(Beginner.btnHover, Beginner.btnHoverOut); } ,btnHover: function() { $(this).fadeTo('fast',.8); } ,btnHoverOut: function() { $(this).fadeTo('fast',1); } }; /*------------------------------------------------ 検討中に関連する各種処理 ------------------------------------------------*/ Kento = { init: function() { //検討中へ追加 | 検討中へ削除（検討中ページ以外で処理する場合） if($('.do_kento').size()){ $('.do_kento').click(function(e) { if($(this).hasClass('add_kento')) { Kento.add($(this)); }else{ Kento.cancel($(this)); } }); } //検討中リスト処理 if($('#kento_form').size()){ //スクロール時処理 $(window).scroll(function(){ if(win_w >= 900){ Kento.scrl_top = parseInt($(this).scrollTop()); Kento.start_fix_pos = parseInt($('#kentotyu_wrap').offset().top) + parseInt($('#kentotyu_wrap').outerHeight(true)); Kento.fotter_pos = parseInt($('footer').offset().top); Kento.fix_inq_btm = Math.abs(Kento.scrl_top) + parseInt($('#inquiry_list_wrap').outerHeight(true)); if(Math.abs(Kento.scrl_top) > Math.abs(Kento.start_fix_pos) && Math.abs(Kento.fix_inq_btm) <= Math.abs(Kento.fotter_pos)){ Kento.side_inq_fix(); }else if(Kento.scrl_flg && Math.abs(Kento.scrl_top) <= Math.abs(Kento.start_fix_pos)){ Kento.side_inq_free(); }else if(Math.abs(Kento.fix_inq_btm) >= Math.abs(Kento.fotter_pos)){ Kento.side_inq_fix_bottom(); } } }); $('.chk_kento').click(function(){ var fid = $(this).val(); var status = ($(this).prop('checked')) ? 1 : 0; Kento.check(fid, status); }); $('#all_chk,#tb_all_chk,#sp_all_chk').click(function(){ var chk = $('#kento_form .chk_kento'); var list = ''; for(var i=0; i 5) { alert(cnt + '件チェックされています。\\nまとめて応募できる店舗は最大5件となります。'); return false; } $('#kento_form').submit(); }); $('.delete_kento').click(function(){ var fid = $(this).data('fid'); Kento.delete(fid, 1); }); $('#all_delete,#tb_all_delete,#sp_all_delete').click(function(){ var chk = $('#kento_form .chk_kento'); var list = ''; for(var i=0; i= 900){ Kento.scrl_top = parseInt($(this).scrollTop()); Kento.start_fix_pos = parseInt($('#kentotyu_wrap').offset().top) + parseInt($('#kentotyu_wrap').outerHeight(true)); Kento.fotter_pos = parseInt($('footer').offset().top); Kento.fix_inq_btm = Math.abs(Kento.scrl_top) + parseInt($('#inquiry_list_wrap').outerHeight(true)); if(Math.abs(Kento.scrl_top) > Math.abs(Kento.start_fix_pos) && Math.abs(Kento.fix_inq_btm) <= Math.abs(Kento.fotter_pos)){ Kento.side_inq_fix(); }else if(Kento.scrl_flg && Math.abs(Kento.scrl_top) <= Math.abs(Kento.start_fix_pos)){ Kento.side_inq_free(); }else if(Math.abs(Kento.fix_inq_btm) >= Math.abs(Kento.fotter_pos)){ Kento.side_inq_fix_bottom(); } } }); $('.delete_apply').click(function(){ var aid = $(this).data('aid'); Apply.delete(aid, 1); }); $('#all_chk,#tb_all_chk,#sp_all_chk').click(function(){ var chk = $('#apply_form .chk_apply'); var cnt = 0; for(var i=0; i<= 0){ alert('全てチェックされています。'); return false; } }); $('#all_un_chk,#tb_all_un_chk,#sp_all_un_chk').click(function(){ var chk = $('#apply_form .chk_apply'); var cnt = 0; for(var i=0; i<= 0){ alert('全てチェックが外れています。'); return false; } }); $('#all_delete,#tb_all_delete,#sp_all_delete').click(function(){ var chk = $('#apply_form [name^=apply_id]:checked'); var list = ''; for(var i=0; i= 900){ Kento.scrl_top = parseInt($(this).scrollTop()); Kento.start_fix_pos = parseInt($('#kentotyu_wrap').offset().top) + parseInt($('#kentotyu_wrap').outerHeight(true)); Kento.fotter_pos = parseInt($('footer').offset().top); Kento.fix_inq_btm = Math.abs(Kento.scrl_top) + parseInt($('#inquiry_list_wrap').outerHeight(true)); if(Math.abs(Kento.scrl_top) > Math.abs(Kento.start_fix_pos) && Math.abs(Kento.fix_inq_btm) <= Math.abs(Kento.fotter_pos)){ Kento.side_inq_fix(); }else if(Kento.scrl_flg && Math.abs(Kento.scrl_top) <= Math.abs(Kento.start_fix_pos)){ Kento.side_inq_free(); }else if(Math.abs(Kento.fix_inq_btm) >= Math.abs(Kento.fotter_pos)){ Kento.side_inq_fix_bottom(); } } }); } //リストから削除 if($('.hide_kento').size()){ $('.hide_kento').click(function(e) { Shop_all_inquiry.hide($(this)); }); } } ,hide: function(e) { var el = e.parents('.link_box'); var fid = el.attr('id'); $('#si_' + fid).hide(); //削除モーション Shop_all_inquiry.slideUp(el); var total = parseInt($('#select_total').val()) - 1; $('#select_total').val(total); if(total <= 0) { $('.side_shop_box').hide(); $('#shop_private_inquiry_wrap').hide(); $('.box_head, article, .age_check').show(); To_top.up(); } } ,slideUp: function(el) { el.slideUp(500, function () { el.remove(); }); } }*/ /*------------------------------------------------ グーグルマップ表示 ------------------------------------------------*/ var gmap = { init: function() { if($('#map_on').size()){ this.gcode_lat = ''; this.gcode_lng = ''; this.shop_name = ''; this.shop_address = ''; this.shop_phone1 = ''; this.flg = true; $('#map_on').click(function(){ gmap.gcode_lat = $(this).data('lat'); gmap.gcode_lng = $(this).data('lng'); gmap.shop_name = $(this).data('name'); gmap.shop_address = $(this).data('address'); gmap.shop_phone1 = $(this).data('phone1'); if($(this).data('lat')){ if(gmap.flg){ //マップ生成 gmap.map_on(); } //マップモーダル上に表示 gmap.map_show(); } }); } } ,map_on: function() { var latlng = new google.maps.LatLng(this.gcode_lat, this.gcode_lng); var options = { zoom: 16, center: latlng, mapTypeId: google.maps.MapTypeId.ROADMAP } var map = new google.maps.Map(document.getElementById('map'), options); var marker = new google.maps.Marker({ position: latlng, map: map, title: this.shop_name }); var contentString = '' + this.shop_name + '<'+'/div>'; contentString += '住所：' + this.shop_address + '<'+'/div>'; contentString += '電話：' + this.shop_phone1 + '<'+'/div>'; var infoWindow = new google.maps.InfoWindow({ content: contentString, maxWidth: 400 }); infoWindow.open(map,marker); google.maps.event.addListener(marker, 'click', function() { infoWindow.open(map,marker); }); this.flg = false; } ,map_show: function() { $('.modal_contents').hide(); $('#modal_contents_map').show(); $('#modal_back, #modal_wrap').fadeIn(300); var height = (parseInt($('#modal_wrap').height()) / 2) * -1; $('#modal_wrap').css('margin-top',height + 'px'); } } /*------------------------------------------------ 汎用的なアコーディオンの処理 ------------------------------------------------*/ Other_accordion = { init: function() { if($('.o_opener')){ this.aco_flg = true; $('.o_opener').on('click', function(evt){ if(!$(evt.target).closest('label').length && !$(evt.target).closest('input').length){ // (2) target = $(this).attr('data-open'); if(target !== ''){ if($(this).hasClass('open')){ Other_accordion.close($(this),$(target)); }else{ Other_accordion.open($(this),$(target)); } } } }); } } ,open: function(that, target) { if(this.aco_flg){ this.aco_flg = false; that.addClass('open'); that.find('.search_icon_plus').hide(); that.find('.search_icon_minus').show(); target.slideDown(300,function(){ if($('.srch_intv').size()){ slide_other(that);//interview only } Other_accordion.aco_flg = true; }); } } ,close: function(that, target) { if(this.aco_flg){ this.aco_flg = false; target.slideUp(300,function(){ if($('.srch_intv').size()){ slide_other(that);//interview only } Other_accordion.aco_flg = true; }); that.removeClass('open'); that.find('.search_icon_minus').hide(); that.find('.search_icon_plus').show(); } } } /*------------------------------------------------ リンクページ用アコーディオン ------------------------------------------------*/ Link_accordion = { init: function() { if($('.link_more').size()){ this.p = '';//親要素 this.e = '';//イベント要素 this.b = '';//ボタンボックスの要素 this.t = '';//開閉する要素 this.flg = true; $('.link_more').click(function(){ if($(this).attr('data-state') == 'open'){ return; } Link_accordion.e = $(this); Link_accordion.open(); }); $('.link_close').click(function(){ if($(this).attr('data-state') == 'close'){ return; } Link_accordion.e = $(this); Link_accordion.close(); }); } } ,set: function() { if(this.e.hasClass('main_contents')){ this.p = this.e; }else{ this.p = this.e.parents('.main_contents'); } this.b = this.p.find('.switch_wrap'); this.t = $(this.p.attr('data-target')); } ,open: function() { if(this.flg){ this.flg = false; this.set(); this.b.find('.link_more').hide().addClass('changed'); this.b.find('.link_close').css('display', 'inline').addClass('changed'); this.t.slideDown(300,function(){ Link_accordion.fin('open'); }); } } ,close: function() { if(this.flg){ this.flg = false; this.set(); this.b.find('.link_more').css('display', 'inline').addClass('changed') this.b.find('.link_close').hide().addClass('changed'); this.t.slideUp(300,function(){ var pos = Link_accordion.p.offset().top $('body, html').animate({ scrollTop: pos }, 200); Link_accordion.fin('close'); }); } } ,fin: function(state) { $('.link_more').attr('data-state', state); $('.link_close').attr('data-state', state); this.flg = true; } } /*------------------------------------------------ カンタン検索のグレーアウト処理 ------------------------------------------------*/ Easy_search_out = { init: function() { if($('#easy_search').size()){ this.e = ''; this.t = ''; this.zone = $('#easy_zone').val(); this.pref = $('#easy_pref').val(); this.data = ''; //this.un_list = ''; this.shift = '';//親 this.tb_shift = '';//親 $('.opt_def').attr('selected','true'); $('#easy_area').change(function(){ if(Easy_search_out.shift == 'type'){ return; } Easy_search_out.e = $('option:selected', this).data('id-val'); Easy_search_out.t = '#easy_type'; Easy_search_out.area_filter(); }); $('#easy_type').change(function(){ if(Easy_search_out.shift == 'area'){ return; } Easy_search_out.e = $('option:selected', this).data('id-val'); Easy_search_out.t = '#easy_area'; Easy_search_out.type_filter(); }); $('#tb_easy_area').change(function(){ if(Easy_search_out.tb_shift == 'type'){ return; } Easy_search_out.e = $('option:selected', this).data('id-val'); Easy_search_out.t = '#tb_easy_type'; Easy_search_out.tb_area_filter(); }); $('#tb_easy_type').change(function(){ if(Easy_search_out.tb_shift == 'area'){ return; } Easy_search_out.e = $('option:selected', this).data('id-val'); Easy_search_out.t = '#tb_easy_area'; Easy_search_out.tb_type_filter(); }); } } ,area_filter: function() { //親(エリア)の条件を変更した場合、子(業種)の条件をリセット if(this.shift == 'area'){ $(this.t + ' option').removeAttr('selected'); $(this.t + ' .opt_def').attr('selected','true'); } this.api_type(); if(this.e === '0') { this.shift = ''; } else { this.shift = 'area'; } } ,type_filter: function() { //親(業種)の条件を変更した場合、子(エリア)の条件をリセット if(this.shift == 'type'){ $(this.t + ' option').removeAttr('selected'); $(this.t + ' .opt_def').attr('selected','true'); } this.api_area(); if(this.e === '0') { //デフォルトを選択した場合、親条件リセット this.shift = ''; } else { this.shift = 'type'; } } ,tb_area_filter: function() { //親(エリア)の条件を変更した場合、子(業種)の条件をリセット if(this.tb_shift == 'area'){ $(this.t + ' option').removeAttr('selected'); $(this.t + ' .opt_def').attr('selected','true'); } this.api_type(); if(this.e === '0') { this.tb_shift = ''; } else { this.tb_shift = 'area'; } } ,tb_type_filter: function() { //親(業種)の条件を変更した場合、子(エリア)の条件をリセット if(this.tb_shift == 'type'){ $(this.t + ' option').removeAttr('selected'); $(this.t + ' .opt_def').attr('selected','true'); } this.api_area(); if(this.e === '0') { this.tb_shift = ''; } else { this.tb_shift = 'type'; } } //業種を選択した時に実行。選択可否を含むエリアリストを取得 ,api_area: function() { $.ajax({ type: \"GET\", url: \"/api/EasyArea/\", cache: false, data: { zone: Easy_search_out.zone ,pref: Easy_search_out.pref ,type: Easy_search_out.e }, dataType: 'json', success: function(data, dataType){ if(data == \"false\")return;//エラー Easy_search_out.data = data; //NOTE: v3.0より選択不可のエリアをグレーアウトではなく非表示にする仕様に変更。 //Easy_search_out.area_out_list(); //Easy_search_out.gray_out(); Easy_search_out.area_change(); }, error: function(XMLHttpRequest, textStatus, errorThrown) { //何もしない //alert('Error : ' + errorThrown); } }); } //エリアを選択した時に実行。選択可否を含む業種リストを取得 ,api_type: function() { //console.log(Easy_search_out.e); $.ajax({ type: \"GET\", url: \"/api/EasyArea/\", cache: false, data: { zone: Easy_search_out.zone ,area: Easy_search_out.e }, dataType: 'json', success: function(data, dataType){ if(data == \"false\")return;//エラー Easy_search_out.data = data; //NOTE: v3.0より選択不可の業種をグレーアウトではなく非表示にする仕様に変更。 //Easy_search_out.type_out_list(); //Easy_search_out.gray_out(); Easy_search_out.type_change(); }, error: function(XMLHttpRequest, textStatus, errorThrown) { //何もしない //alert('Error : ' + errorThrown); } }); } //業種選択時に取得したエリアデータを反映 ,area_change: function() { //console.log(this.data); var cnt = Object.keys(this.data).length; var options = 'エリア'; var list_num = ''; for(i=0; i' + this.data[i].name + ''; } if(this.data[i].list){ list_num = Object.keys(this.data[i].list).length; //小エリアをループ for(j=0; j' + this.data[i].list[j].prefix + this.data[i].list[j].name + ''; } } } } $(this.t).empty().append(options); } //エリア選択時に取得した業種データを反映 ,type_change: function() { var cnt = Object.keys(this.data).length; var options = '業種'; for(i=0; i' + this.data[i].short_name + ''; } } $(this.t).empty().append(options); } //エリアグレーアウトするものを収集 /*,area_out_list: function() { var cnt = Object.keys(this.data).length; var list_num = ''; this.un_list = ''; //ループしながら選択不可の要素を集める for(a = 0; a < cnt; a++){ if(this.data[a].selectable === 0){ if(this.un_list === ''){ this.un_list = this.t + ' .opt_' + this.data[a].num; }else{ this.un_list += ',' + this.t + ' .opt_' + this.data[a].num; } } if(this.data[a].list){ list_num = Object.keys(this.data[a].list).length; //小エリアをループ for(b = 0; b < list_num; b++){ if(this.data[a].list[b].selectable === 0){ if(this.un_list === ''){ this.un_list = this.t + ' .opt_' + this.data[a].list[b].num; }else{ this.un_list += ',' + this.t + ' .opt_' + this.data[a].list[b].num; } } } } } } //業種グレーアウトするものを収集 ,type_out_list: function() { var cnt = Object.keys(this.data).length; this.un_list = ''; //ループしながら選択不可の要素を集める for(a = 0; a < cnt; a++){ if(this.data[a].selectable === 0){ if(this.un_list === ''){ this.un_list = this.t + ' .opt_' + a; }else{ this.un_list += ',' + this.t + ' .opt_' + a; } } } } //グレーアウト実行 ,gray_out: function() { if(this.un_list){ $(this.t + ' option').removeAttr('disabled'); $(this.un_list).attr('disabled','disabled'); } this.un_list = '';//実行したら初期化 }*/ } /*------------------------------------------------ hashchange ------------------------------------------------*/ Hashchange = { init: function() { $(window).on('hashchange', function() { var hash = location.hash; $('a').each(function() { if ($(this).attr('href') == hash) { $(this).addClass('selected'); } else { $(this).removeClass('selected'); } }); //NOTE: 応募方法一覧に反応するので、店舗詳細は除外 if(win_w < 620 && $('#paid_shop_data').size() == 0){ Go_to.go(hash, false); } }); if(location.hash){ $(window).on('load', function() { $(window).trigger('hashchange'); }); } } } /*------------------------------------------------ はじめての質問箱の質問投稿フォーム ------------------------------------------------*/ var QA_form = { init: function() { if($('#pc_qa_submit, #sp_qa_submit').size()){ $('#pc_qa_submit, #sp_qa_submit').click(function(){ $('#qa_posting').submit(); }); } } };"
