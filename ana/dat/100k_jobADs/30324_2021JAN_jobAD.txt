}You can notice two things here:We use the ErrorTrigger attribute to be able to use ErrorTrigger extension in the GlobalErrorMonitor function.We use the SendGrid attribute to be able to use SendGrid in the GlobalErrorMonitor function.Example of useOnce the WebJob ready and properly configured, we will launch it:Found the following functions:AzureWebJobs.ErrorsEmails.Functions.ProcessQueueMessageJob host startedNow add an empty message to the queue. The ProcessQueueMessage function will be called 5 times and the message will be moved to the queue-poison.After the second exception, you can notice that GlobalErrorMonitor is triggered:Executing 'Functions.ProcessQueueMessage' (Reason='New queue message detected on 'queue'.', Id=8ee22555-15df-458e-8a0e-cdd1b9b2a97a)Executing 'Functions.GlobalErrorMonitor' (Reason='Error trigger fired', Id=8b368696-7dab-4908-af53-18018abd8f3e)An error has been detected in a function.2 events at level 'Error' or lower have occurred within time window 00:03:00.05/16/2017 02:41:20 Error Exception while executing function: Functions.ProcessQueueMessage WebJobs.ExecutionMicrosoft.Azure.WebJobs.Host.FunctionInvocationException: Exception while executing function: Functions.ProcessQueueMessage ---> System.ArgumentNullException:Value cannot be null. Parameter name: messageExecuted 'Functions.GlobalErrorMonitor' (Succeeded, Id=8b368696-7dab-4908-af53-18018abd8f3e)Executed 'Functions.ProcessQueueMessage' (Succeeded, Id=8ee22555-15df-458e-8a0e-cdd1b9b2a97a)You should receive an email to the address you've specified in the To property of the SendGrid attribute. The title will be as WebJob - Warning - An error has been detected in a job, and the body will contain the exception with the stack trace.To go furtherThe error trigger is configured to be called whenever 2 errors occur within a 3 minutes sliding window throttled at a maximum of 2 notifications per 10 minutes.You can easily configure it differently to receive less notifications:public static void GlobalErrorMonitor([ErrorTrigger(\"0:10:00\", 5, Throttle = \"1:00:00\")] TraceFilter filter, TextWriter log, [SendGrid(From = \"no-reply@anydomainxyz.com\", To = \"anybody@anydomainxyz.com\")] out Mail mail)SummaryWe have seen how to send emails from an Azure WebJob with the SenGrid extension when errors are detected using the ErrorTrigger extension.You can download the example solution here:Download full sourcesOrBrowse the GitHub repository(Note that the project uses Microsoft.Azure.WebJobs version 2.0.0)Please feel free to comment or contact me if you have any question about this article.EnglishMicrosoftAzureApp ServiceWebJobsAdd a commentLanguage English FrenchNameNameE-mail (Will not be published)E-mail (Will not be published)Website urlMessageMessageBack to articlesÂ© 2021 Vivien Chevallier crasydev.com"
