"incremental backup fails via cronjob but works manuallyZmanda ForumsRegisterHelpRemember Me?Today's PostsFAQCalendarForum ActionsMark Forums ReadQuick LinksAmanda DocumentationMySQL Backup documentationAmanda downloadsZRM downloadsBackupPC downloadsAdvanced SearchForumZmanda Recovery Manager (ZRM) for MySQLZRM 2.0 Installation, Configuration and Administrationincremental backup fails via cronjob but works manuallyIf this is your first visit, be sure to check out the FAQ by clicking the link above. You may have to register before you can post: click the register link above to proceed. To start viewing messages, select the forum that you want to visit from the selection below.Results 1 to 4 of 4Thread: incremental backup fails via cronjob but works manuallyThread ToolsShow Printable VersionEmail this Page…Subscribe to this Thread…Search ThreadAdvanced SearchDisplayLinear ModeSwitch to Hybrid ModeSwitch to Threaded ModeOctober 31st, 2013, 01:46 AM #1arndttView ProfileView Forum PostsJoin DateOct 2013LocationStuttgart, GermanyPosts3incremental backup fails via cronjob but works manually [Solved]Hi,we are using ZRM for MySQL Community Edition - version 2.2.0 on a CentOS 6 system in order to backup several remote databases. Tried to activate some incremental backups additionally to the already working full backups which is working fine if i do this manually as user mysql ( ssh without password is not the issue here) but via cronjob it fails. I guess I'm having an environment variable problem here when I look at the timestamps of the logfiles ( Do Okt 31 manual via cronjob Thu Oct 31 ). As I mentioned the manual approach and the crontab is in the same mysql user account. Is it possible that via cron half of the environment is loaded ?Best Regards,Tobias################################################## ############when I start the backup manually via mysql-zrm-scheduler --now --backup-set fcsv046 --backup-level 1Do Okt 31 09:01:54 2013: fcsv046:backup:INFO: START OF BACKUPDo Okt 31 09:01:54 2013: fcsv046:backup:INFO: PHASE START: InitializationDo Okt 31 09:01:54 2013: fcsv046:backup:INFO: The quick backup-type is supported only for snapshot backups. Setting backup-type to 'regular'Do Okt 31 09:01:54 2013: fcsv046:backup:INFO: backup-set=fcsv046Do Okt 31 09:01:54 2013: fcsv046:backup:INFO: backup-date=20131031090154Do Okt 31 09:01:54 2013: fcsv046:backup:INFO: mysql-server-os=Linux/UnixDo Okt 31 09:01:54 2013: fcsv046:backup:INFO: backup-type=regularDo Okt 31 09:01:54 2013: fcsv046:backup:INFO: host=fcsv046.fce.comDo Okt 31 09:01:54 2013: fcsv046:backup:INFO: backup-date-epoch=1383206514Do Okt 31 09:01:54 2013: fcsv046:backup:INFO: retention-policy=7DDo Okt 31 09:01:54 2013: fcsv046:backup:INFO: mysql-zrm-version=ZRM for MySQL Community Edition - version 2.2.0Do Okt 31 09:01:54 2013: fcsv046:backup:INFO: mysql-version=5.5.31-0ubuntu0.12.10.1-logDo Okt 31 09:01:54 2013: fcsv046:backup:INFO: backup-directory=/home/zrm/zrm-backups/fcsv046/20131031090154Do Okt 31 09:01:54 2013: fcsv046:backup:INFO: backup-level=1Do Okt 31 09:01:54 2013: fcsv046:backup:INFO: PHASE END: InitializationDo Okt 31 09:01:54 2013: fcsv046:backup:INFO: PHASE START: Running pre backup pluginDo Okt 31 09:01:54 2013: fcsv046:backup:INFO: PHASE END: Running pre backup pluginDo Okt 31 09:01:54 2013: fcsv046:backup:INFO: PHASE START: Flushing logsDo Okt 31 09:01:54 2013: fcsv046:backup:INFO: PHASE END: Flushing logsDo Okt 31 09:01:54 2013: fcsv046:backup:INFO: PHASE START: Creating incremental backupDo Okt 31 09:01:55 2013: fcsv046:backup:INFO: incremental=mysql-bin.[0-9]*Do Okt 31 09:01:55 2013: fcsv046:backup:INFO: PHASE END: Creating incremental backupDo Okt 31 09:01:55 2013: fcsv046:backup:INFO: PHASE START: Calculating backup size & checksumsDo Okt 31 09:01:55 2013: fcsv046:backup:INFO: next-binlog=mysql-bin.000014Do Okt 31 09:01:55 2013: fcsv046:backup:INFO: last-backup=/home/zrm/zrm-backups/fcsv046/20131031041001Do Okt 31 09:01:55 2013: fcsv046:backup:INFO: backup-size=0.16 MBDo Okt 31 09:01:55 2013: fcsv046:backup:INFO: PHASE END: Calculating backup size & checksumsDo Okt 31 09:01:55 2013: fcsv046:backup:INFO: PHASE START: Compression/EncryptionDo Okt 31 09:01:55 2013: fcsv046:backup:INFO: compress=Do Okt 31 09:01:55 2013: fcsv046:backup:INFO: backup-size-compressed=0.02 MBDo Okt 31 09:01:55 2013: fcsv046:backup:INFO: PHASE END: Compression/EncryptionDo Okt 31 09:01:55 2013: fcsv046:backup:INFO: read-locks-time=00:00:00Do Okt 31 09:01:55 2013: fcsv046:backup:INFO: flush-logs-time=00:00:00Do Okt 31 09:01:55 2013: fcsv046:backup:INFO: compress-encrypt-time=00:00:00Do Okt 31 09:01:55 2013: fcsv046:backup:INFO: backup-time=00:00:01Do Okt 31 09:01:55 2013: fcsv046:backup:INFO: backup-status=Backup succeededDo Okt 31 09:01:55 2013: fcsv046:backup:INFO: Backup succeededDo Okt 31 09:01:55 2013: fcsv046:backup:INFO: PHASE START: Running post backup pluginDo Okt 31 09:01:55 2013: fcsv046:backup:INFO: PHASE END: Running post backup pluginDo Okt 31 09:01:55 2013: fcsv046:backup:INFO: PHASE START: Mailing backup reportDo Okt 31 09:01:55 2013: fcsv046:backup:INFO: PHASE END: Mailing backup reportDo Okt 31 09:01:56 2013: fcsv046:backup:INFO: PHASE START: CleanupDo Okt 31 09:01:56 2013: fcsv046:backup:INFO: PHASE END: CleanupDo Okt 31 09:01:56 2013: fcsv046:backup:INFO: END OF BACKUPWhen I start it via crontab mysql-zrm-scheduler --add --interval daily --start 09:00 --backup-set fcsv046 --backup-level 1Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: START OF BACKUPThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE START: InitializationThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: The quick backup-type is supported only for snapshot backups. Setting backup-type to 'regular'Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: backup-set=fcsv046Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: backup-date=20131031090002Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: mysql-server-os=Linux/UnixThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: backup-type=regularThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: host=fcsv046.fce.comThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: backup-date-epoch=1383206402Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: retention-policy=7DThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: mysql-zrm-version=ZRM for MySQL Community Edition - version 2.2.0Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: mysql-version=5.5.31-0ubuntu0.12.10.1-logThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: backup-directory=/home/zrm/zrm-backups/fcsv046/20131031090002Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: backup-level=1Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE END: InitializationThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE START: Running pre backup pluginThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE END: Running pre backup pluginThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE START: Flushing logsThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE END: Flushing logsThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE START: Creating incremental backupThu Oct 31 09:00:02 2013: fcsv046:backup:ERROR: Could not copy file \"/var/lib/mysql/mysql-bin.000011\"Thu Oct 31 09:00:02 2013: fcsv046:backup:ERROR: copy-plugin exited with error 512Thu Oct 31 09:00:02 2013: fcsv046:backup:ERROR: Could not copy bin log file /home/zrm/zrm-backups/fcsv046/20131031090002/mysql-bin.000011Thu Oct 31 09:00:02 2013: fcsv046:backup:ERROR: Could not copy file \"/var/lib/mysql/mysql-bin.000012\"Thu Oct 31 09:00:02 2013: fcsv046:backup:ERROR: copy-plugin exited with error 512Thu Oct 31 09:00:02 2013: fcsv046:backup:ERROR: Could not copy bin log file /home/zrm/zrm-backups/fcsv046/20131031090002/mysql-bin.000012Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: incremental=mysql-bin.[0-9]*Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE END: Creating incremental backupThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE START: Calculating backup size & checksumsThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: next-binlog=mysql-bin.000013Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: last-backup=/home/zrm/zrm-backups/fcsv046/20131031041001Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: backup-size=0.00 MBThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE END: Calculating backup size & checksumsThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE START: Compression/EncryptionThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: compress=Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: backup-size-compressed=0.00 MBThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE END: Compression/EncryptionThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: read-locks-time=00:00:00Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: flush-logs-time=00:00:00Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: compress-encrypt-time=00:00:00Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: backup-time=00:00:00Thu Oct 31 09:00:02 2013: fcsv046:backup:INFO: backup-status=Backup done but with errorsThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: Backup done but with errorsThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE START: Running post backup pluginThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE END: Running post backup pluginThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE START: Mailing backup reportThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE END: Mailing backup reportThu Oct 31 09:00:02 2013: fcsv046:backup:INFO: PHASE START: CleanupThu Oct 31 09:00:03 2013: fcsv046:backup:INFO: PHASE END: CleanupThu Oct 31 09:00:03 2013: fcsv046:backup:INFO: END OF BACKUPLast edited by arndtt; November 4th, 2013 at 01:01 AM.Reply With QuoteOctober 31st, 2013, 02:35 AM #2arndttView ProfileView Forum PostsJoin DateOct 2013LocationStuttgart, GermanyPosts3I can describe my problem a little clearer now. I'm starting the ssh-agent via .bash_profile on my ZRM Server####SSHagent settings####SSH_ENV=\"$HOME/.ssh/environment\"function start_agent {echo \"Initializing new SSH agent...\"/usr/bin/ssh-agent | sed 's/^echo/#echo/' > \"${SSH_ENV}\"echo succeededchmod 600 \"${SSH_ENV}\". \"${SSH_ENV}\" > /dev/null/usr/bin/ssh-add;}# Source SSH settings, if applicableif [ -f \"${SSH_ENV}\" ]; then. \"${SSH_ENV}\" > /dev/nullps -ef | grep ${SSH_AGENT_PID} | grep ssh-agent$ > /dev/null || {start_agent;}elsestart_agent;fiAnd .bash_profile is normally not loaded via crontab... How do I get my ssh-agent started via crontab jobs ? Thanks for any help!Reply With QuoteOctober 31st, 2013, 06:29 AM #3martineauView ProfileView Forum PostsAmanda hackerJoin DateNov 2005LocationCanadaPosts1,049Most user use a dedicated password-less ssh key when using amanda.You will not be able to run ssh-add from cron, so ssh-agent must already be runningAdd a script in cron that set the ssh env and then execute amdump:simplified script:#!/bin/bashSSH_ENV=\"$HOME/.ssh/environment\". \"${SSH_ENV}\" > /dev/nullamdump ....Reply With QuoteNovember 4th, 2013, 12:58 AM #4arndttView ProfileView Forum PostsJoin DateOct 2013LocationStuttgart, GermanyPosts3Thanks, martineau works for me this wayReply With QuoteQuick Navigation ZRM 2.0 Installation, Configuration and Administration TopSite AreasSettingsPrivate MessagesSubscriptionsWho's OnlineSearch ForumsForums HomeForumsZmanda Customer ForumsAmanda EnterpriseZmanda Recovery Manager (ZRM) for MySQLZmanda Cloud Backup (ZCB)Amanda community forumsAmanda 3.5 Installation, Configuration and AdministrationAmanda 3.4 Installation, Configuration and AdministrationAmanda 3.3.x Installation, Configuration and AdministrationAmanda 2.6.x Installation, Configuration and AdministrationZmanda Windows Client (Community Edition)Amanda 3.2.x Installation, Configuration and AdministrationAmanda 3.1.x Installation, Configuration and AdministrationInstallation & Administration of AmandaBackup, Archive & Disaster Recovery best practicesAmanda development discussionOperating Systems & Hardware specific issues with AmandaAmanda 2.5.x Installation, Configuration and AdministrationAmanda performance & scalability and real-life Amanda success storiesWindows clientOther uncategorized issuesSuggestions boxAmanda patchesRelease 2.5.0 beta discussionRelease 2.5.1 beta discussionBackupPC ForumsBackupPC Community Edition 3.1.0+FTP« Previous Thread | Next Thread »Posting PermissionsYou may not post new threadsYou may not post repliesYou may not post attachmentsYou may not edit your postsBB code is OnSmilies are On[IMG] code is On[VIDEO] code is OnHTML code is OffForum RulesContact UsHomeArchiveTopAll times are GMT -8. The time now is 05:50 PM."
